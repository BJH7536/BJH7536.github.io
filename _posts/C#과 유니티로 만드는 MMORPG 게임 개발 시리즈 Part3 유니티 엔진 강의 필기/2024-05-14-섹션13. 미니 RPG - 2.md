---
title: ì„¹ì…˜13. ë¯¸ë‹ˆ RPG - 2
date:   2024-05-14 +0900
categories: [C#ê³¼ ìœ ë‹ˆí‹°ë¡œ ë§Œë“œëŠ” MMORPG ê²Œì„ ê°œë°œ ì‹œë¦¬ì¦ˆ Part3 ìœ ë‹ˆí‹° ì—”ì§„ ê°•ì˜ í•„ê¸°]
tags: [Unity]
math: true
mermaid: true
---

> ìœ„ ê¸€ì€ ì¸í”„ëŸ°ì— ìˆëŠ” Rookissë‹˜ì˜ [C#ê³¼ ìœ ë‹ˆí‹°ë¡œ ë§Œë“œëŠ” MMORPG ê²Œì„ ê°œë°œ ì‹œë¦¬ì¦ˆ] Part3: ìœ ë‹ˆí‹° ì—”ì§„ ê°•ì˜ë¥¼ ë“£ê³  ë‚¨ê¸´ í•„ê¸°ì…ë‹ˆë‹¤.

## íƒ€ê²ŒíŒ… ë½ì˜¨

- ë§ˆìš°ìŠ¤ í¬ì¸í„°ë¥¼ ëˆ„ë¥´ê¸° ì‹œì‘í•œ ëŒ€ìƒì— ëŒ€í•´ì„œ (ë•…, í˜¹ì€ ëª¬ìŠ¤í„°) ë§ˆìš°ìŠ¤ë¥¼ ë†“ì§€ì•Šê³  ê³„ì†í•´ì„œ ë“œë˜ê·¸ë¥¼ í•˜ê³  ìˆëŠ” ìƒíƒœë¼ë©´, ì²˜ìŒì˜ ëŒ€ìƒì— ë”°ë¼ ë‹¤ë¥¸ í–‰ë™ì„ í•œë‹¤.
    - ë•…ì—ì„œ í´ë¦­ì„ ì‹œì‘í•˜ê³ , ë§ˆìš°ìŠ¤ë¥¼ ë“œë˜ê·¸í•œë‹¤ë©´ â‡’ ê³„ì†í•´ì„œ **ë§ˆìš°ìŠ¤ í¬ì¸í„°ë¥¼ í–¥í•´ ì´ë™**í•œë‹¤.
    - ëª¬ìŠ¤í„°ì—ì„œ í´ë¦­ì„ ì‹œì‘í•˜ê³  ë§ˆìš°ìŠ¤ë¥¼ ë“œë˜ê·¸í•œë‹¤ë©´ â‡’ **ëª¬ìŠ¤í„°ì—ê²Œ ë½ì˜¨**, ë§ˆìš°ìŠ¤ì˜ ìœ„ì¹˜ê°€ ë³€í•´ë„, ê³„ì† ê°™ì€ ëŒ€ìƒì„ ê³µê²©í•˜ê³  ìˆëŠ”ë‹¤.
- ê¸°ì¡´ì—ëŠ” ë§ˆìš°ìŠ¤ì— ëŒ€í•œ ì…ë ¥ì„ ë°›ì„ ë•Œ, ë‘ê°€ì§€ë¡œ êµ¬ë¶„í•´ì„œ ë°›ì•˜ìŒ.
    - ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥¼ ë•Œ Press
    - ëˆŒë €ë‹¤ê°€ ë—„ ë•Œ Click
    - ì´ì œ ë”ìš± ì„¸ë¶„í™” í•´ì•¼ í•¨ (+ PointerDown, PointerUp)
        
```csharp
public enum MouseEvent
{
    Press,
    PointerDown,
    PointerUp,
    Click,
}
```
        
- ì´ì— ë”°ë¼, `InputManager.cs`ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜ì •
        
```csharp
public class InputManager
{
    public Action KeyAction = null;
    public Action<Define.MouseEvent> MouseAction = null;

    private bool _pressed = false;
    // Clickê³¼ PointUpì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´, ë§ˆìš°ìŠ¤ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ìˆëŠ” ì‹œê°„ì„ ê¸°ë¡í•˜ëŠ” float
    private float _pressedTime = 0;
    
    public void OnUpdate()
    {
        if (EventSystem.current.IsPointerOverGameObject())  // UIê°€ í´ë¦­ëœ ìƒí™©ì´ë¼ë©´ ë™ì‘ X
            return;
        
        if (Input.anyKey && KeyAction != null)        // ì–´ë– í•œ ì…ë ¥ì´ë¼ë„ ìˆê³ , KeyActionì´ ë¹„ì–´ìˆì§€ ì•Šë‹¤ë©´,
            KeyAction.Invoke();

        if (MouseAction != null)
        {
            if (Input.GetMouseButton(0))                            // ë§ˆìš°ìŠ¤ê°€ ëˆŒë¦°ë‹¤ë©´,
            {
                if (!_pressed)      // ë§ˆìš°ìŠ¤ ë²„íŠ¼ì´ ëˆŒë¦¼ && ì²˜ìŒ ëˆŒë¦¼ => PointerDown
                {
                    MouseAction.Invoke(Define.MouseEvent.PointerDown);
                    // ì´ ë•Œ ë¶€í„°, ì‹œê°„ì„ ê¸°ë¡.
                    _pressedTime = Time.time;
                }
                    
                MouseAction.Invoke(Define.MouseEvent.Press);    // (1)ì¼ë‹¨ Pressì— í•´ë‹¹í•˜ëŠ” ì´ë²¤íŠ¸ë¥¼ Invoke
                _pressed = true;                                   // (2)ëˆŒë ¸ë‹¤ê°€,
            }
            else                    
            {
                if (_pressed)       // ë§ˆìš°ìŠ¤ê°€ ëˆŒë¦¬ë‹¤ê°€ ì•ˆëˆŒë¦´ ë•Œ
                {
                    // 0.2ì´ˆ ë‚´ì— ë§ˆìš°ìŠ¤ ë²„íŠ¼ì„ ë‹¤ì‹œ ì˜¬ë¦¬ë©´, ê·¸ê²ƒì„ í´ë¦­ìœ¼ë¡œ ì¸ì‹
                    if(Time.time < _pressedTime + 0.2f)     
                        MouseAction.Invoke(Define.MouseEvent.Click);   // ë–¨ì–´ì§ˆ ë•Œ, Click ì´ë²¤íŠ¸ë¥¼ Invoke
                    
                    // ê·¸ëƒ¥ PointerUpì€ ë¬´ì¡°ê±´ ì‹¤í–‰
                    MouseAction.Invoke(Define.MouseEvent.PointerUp);
                }

                _pressed = false;
                _pressedTime = 0;       // ë§ˆìš°ìŠ¤ ì¿¨ë¦­ ì‹œê°„ ê¸°ë¡ ì´ˆê¸°í™”
            }
        }
    }

    public void Clear()
    {
        KeyAction = null;
        MouseAction = null;
    }
}
```
        
- `PlayerController.cs` ë‚´ì˜ `OnMouseClicked`ë¥¼ `OnMouseEvent`ë¡œ ë³€ê²½
        
```csharp
// í”Œë ˆì´ì–´ê°€ ë”°ë¼ê°€ëŠ” ëª¬ìŠ¤í„° íƒ€ê²Ÿ
private GameObject _lockTarget;

/// <summary>
/// ë§ˆìš°ìŠ¤ì˜ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
/// </summary>
/// <param name="mouseEvent">ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ì˜ íƒ€ì…</param>
void OnMouseEvent(Define.MouseEvent mouseEvent)
{
    if (_state == PlayerState.Die) 
        return;
    
    var ray = Camera.main.ScreenPointToRay(Input.mousePosition);
    //Debug.DrawRay(Camera.main.transform.position, ray.direction * 100.0f, Color.red,1.0f);

    bool raycastHit = Physics.Raycast(ray, out var hit, 100.0f, _mask);

    switch (mouseEvent)
    {
        case Define.MouseEvent.PointerDown:     // ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ëŠ” ìˆœê°„
        {
            // TODO í¬ì¸í„°ê°€ ëª¬ìŠ¤í„°ì— ìˆê±°ë‚˜
            // TODO í¬ì¸í„°ê°€ ë•…ì— ìˆê±°ë‚˜
            
            if (raycastHit)     // rayê°€ ë§ì€ ê³³ì— ë¬´ì¡°ê±´ ì´ë™ (ëª¬ìŠ¤í„°, ë•… êµ¬ë¶„ X)
            {
                _destPos = hit.point;
                _state = PlayerState.Moving;

                // ëª¬ìŠ¤í„°ì™€ ë•… êµ¬ë¶„
                if (hit.collider.gameObject.layer == (int)Define.Layer.Monster)
                    _lockTarget = hit.collider.gameObject;
                else
                    _lockTarget = null;
            }
        }
            break;
        case Define.MouseEvent.Press:       // ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ê³  ìˆëŠ” ìƒíƒœ
        {
            if (_lockTarget != null)        // _lockTargetì´ ìˆë‹¤ë©´ ë”°ë¼ê°€ê³ 
                _destPos = _lockTarget.transform.position;
            else
                if (raycastHit)             // ì—†ë‹¤ë©´ rayê°€ ë§ì€ ë•…ì˜ ì§€ì ìœ¼ë¡œ ì´ë™
                    _destPos = hit.point;
        }
            break;  
        case Define.MouseEvent.PointerUp:       // ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ëŠ” ê²ƒì„ ë©ˆì¶”ì—ˆë‹¤ë©´,
            _lockTarget = null;                 // _lockTargetì„ ë¹„ì›Œì„œ ì •ì§€
            break;
    }
    
}
```

## ê³µê²© #1 & #2

- ì¢Œí´ë¦­ì„ í†µí•´ ëª¬ìŠ¤í„°ë¥¼ ê³µê²©í•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€.
- ì§§ê²Œ í´ë¦­í•˜ë©´ í´ë¦­í•  ë•Œë§ˆë‹¤ ê³µê²©ì„ 1íšŒì”© í•˜ê³ , ê¸¸ê²Œ ëˆ„ë¥´ê³  ìˆë‹¤ë©´ ê³µê²©ì„ ì—°ì†ì ìœ¼ë¡œ ë°˜ë³µí•˜ëŠ” ì‹ìœ¼ë¡œ êµ¬í˜„. (ë””ì•„ë¸”ë¡œ ìŠ¤íƒ€ì¼)

- PlayerController í´ë˜ìŠ¤ ì•ˆì—ì„œ ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ ë³€í™”ì‹œí‚¤ëŠ” í•¨ìˆ˜ì™€, ì´ì— ê´€ë ¨í•œ ë³€ìˆ˜ë“¤, ê·¸ë¦¬ê³  ì—´ê±°í˜•ê¹Œì§€ëŠ” PlayerControllerì˜ ë‹¤ë¥¸ ë¶€ë¶„ê³¼ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘í•˜ë¯€ë¡œ, ì´ë¥¼ ë¶„ë¦¬í•˜ê³  ìƒˆë¡œìš´ CursorControllerë¥¼ ìƒì„±í•´ ì´ì‹.

```csharp
public class CursorController : MonoBehaviour
{
    // ë§ˆìš°ìŠ¤ í´ë¦­ì— ë°˜ì‘ í•  ë ˆì´ì–´ë§Œ ë§ˆìŠ¤í‚¹
    private int _mask = (1 << (int)Define.Layer.Ground) | (1 << (int)Define.Layer.Monster);

    private Texture2D _attackIcon; 
    private Texture2D _handIcon;

    enum CursorType
    {
        None,
        Attack,
        Hand,
    }

    private CursorType _cursorType = CursorType.None;
    
    void Start()
    {
        _attackIcon = Managers.Resource.Load<Texture2D>("Textures/Cursor/Attack");
        _handIcon = Managers.Resource.Load<Texture2D>("Textures/Cursor/Hand");

    }

    void Update()
    {
        // ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ë¡œì§
        
        if (Input.GetMouseButton(0))
            return;
        
        var ray = Camera.main.ScreenPointToRay(Input.mousePosition);
        Debug.DrawRay(Camera.main.transform.position, ray.direction * 100.0f, Color.red,1.0f);
        
        if (Physics.Raycast(ray, out var hit, 100.0f, _mask))
        {
            if (hit.collider.gameObject.layer == (int)Define.Layer.Monster)
            {
                if (_cursorType != CursorType.Attack)
                {
                    Cursor.SetCursor(_attackIcon, new Vector2(_attackIcon.width / 5, 0), CursorMode.Auto);
                    _cursorType = CursorType.Attack;
                }
            }
            else
            {
                if (_cursorType != CursorType.Hand)
                {
                    Cursor.SetCursor(_handIcon, new Vector2(_handIcon.width / 3, 0), CursorMode.Auto);
                    _cursorType = CursorType.Hand;
                }
            }
        }
    }
}
```

- ì§§ê²Œ í´ë¦­í•˜ë©´ í´ë¦­í•  ë•Œ ê³µê²©ì„ í•´ì•¼í•˜ë¯€ë¡œ, PlayerController.OnMouseEvent(Define.MouseEvent mouseEvent) í•¨ìˆ˜ ë‚´ë¶€ì˜ mouseEventì— ë”°ë¥¸ switchë¬¸ ë‚´ì—ì„œ PointerUpì— ë”°ë¥¸ ë¶„ê¸°ë¥¼ ì‚­ì œí•¨
- ê³µê²©í•˜ëŠ” ê¸°ëŠ¥ì€ PlayerController í´ë˜ìŠ¤ì˜ Update() í•¨ìˆ˜ ë‚´ì—ì„œ state ë³„ë¡œ ë¶„ê¸°í•  ë•Œ PlayerState.Skill ì— ëŒ€í•œ ë¶„ê¸°ë¥¼ ë§Œë“¤ê³ ,  í•´ë‹¹ ë¶„ê¸°ì—ì„œ ì‹¤í–‰í•  UpdateSkill() í•¨ìˆ˜ë¥¼ ë§Œë“¤ê³ , ì‹¤í–‰ì‹œí‚¤ë©´ ëœë‹¤! ì¼ë‹¨ ê°„ë‹¨í•˜ê²Œ ë‚´ë¶€ì— Debug.Log() ë§Œ ë„£ê³  ëŒë¦¬ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì˜ ë™ì‘í•œë‹¤.

![MMO_Unity-Game-WindowsMacLinux-Unity2022 3 16f1_DX11_2024-02-1522-55-19-ezgif com-cut](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/404653c6-7fe8-4121-a512-d1f4a58bc55b)

- ì´ì œ ë•Œë¦¬ëŠ” ì• ë‹ˆë©”ì´ì…˜ì„ ì¶”ê°€í•´ì£¼ì.
- ì €ë²ˆì— ì¶”ê°€í•œ Knightì˜ ê³µê²© ì• ë‹ˆë©”ì´ì…˜ì„ í™œìš©í•´ë³´ì. PlayerAnimControllerì— ì´ë¥¼ ì¶”ê°€í•´ì£¼ê³ ,

![Untitled (12)](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/6c770992-c7ff-4bf8-b1ca-f218e92cf578)

ì´ë ‡ê²Œ ì–´ë–¤ ìƒíƒœì—ì„œë„ ê³µê²©ìœ¼ë¡œ ì „í™˜ì´ ê°€ëŠ¥í•˜ë„ë¡ ë§Œë“¤ì. ê·¸ë¦¬ê³  Animator Windowì˜ Parameterë¡œ attackì´ë¼ëŠ” ì´ë¦„ì˜ boolì„ ë§Œë“¤ì–´, ì´ê²ƒì„ ATTACK ì• ë‹ˆë©”ì´ì…˜ì˜ Transition ì¡°ê±´ìœ¼ë¡œ í™œìš©í•˜ì.

ê·¸ë¦¬ê³  PlayerControllerì˜ `UpdateSkill()` í•¨ìˆ˜ ì•ˆì— Animator ì»´í¬ë„ŒíŠ¸ì— ì ‘ê·¼í•´ `SetBool`í•¨ìˆ˜ë¡œ ì´ë¥¼ trueë¡œ ë°”ê¿”ì£¼ë©´, ì˜ ë³€í•  ìˆ˜ ìˆë‹¤.

ê·¸ë¦¬ê³  ë‹¤ì‹œ WAITì´ë‚˜ RUN ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ì „í™˜í•˜ê¸° ìœ„í•´ì„œ

![Untitled (14)](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/15900a58-97f7-4b95-b5a4-bdfae6264956)

ATTACK ì• ë‹ˆë©”ì´ì…˜ì˜ Import Settingsì—ì„œ ì´ë ‡ê²Œ Animation Eventë¥¼ ë§Œë“¤ì–´ ì¤€ í›„, PlayerController ìŠ¤í¬ë¦½íŠ¸ ë‚´ì—ì„œ ì´ë¥¼ ë°›ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ê³ , ì—¬ê¸°ì„œ ë‹¤ì‹œ Animator ì»´í¬ë„ŒíŠ¸ì˜ SetBool í•¨ìˆ˜ë¥¼ í™œìš©í•´ ë‹¤ë¥¸ ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ì „í™˜ì‹œí‚¬ ìˆ˜ ìˆê² ë‹¤. ì´ ë•Œ, _stateë„ ë‹¤ì‹œ idleë¡œ ë°”ê¾¸ëŠ” ê±¸ ìŠì§€ ë§ì.

- ê·¸ë¦¬ê³  stateì˜ í”„ë¡œí¼í‹°ì¸ Stateë¥¼ ë§Œë“œëŠ”ë°, ì´ëŠ” stateë¥¼ ë°”ê¾¸ëŠ” ì½”ë“œì™€ Animator ì»´í¬ë„ŒíŠ¸ì˜ Set ê³„ì—´ í•¨ìˆ˜ë“¤ì„ ë¶€ë¥´ëŠ” ì½”ë“œê°€ ë³„ë„ë¡œ ë˜ì–´ìˆëŠ”ê±¸ í•˜ë‚˜ë¡œ í•©ì³ ì‹¤ìˆ˜ë¥¼ ì¤„ì´ê¸° ìœ„í•¨ì´ë‹¤.

```cs
// ì´ë ‡ê²Œ í•˜ë©´ ì´ Stateì˜ setterê°€ call ë  ë•Œ ë§ˆë‹¤, stateì— ë”°ë¼ Animatorì˜ Set ê³„ì—´ í•¨ìˆ˜ë¥¼ Callí•˜ë‹ˆ, ì¼ì²´í™”ëŠ” ì„±ê³µì ìœ¼ë¡œ ë§Œë“¤ì—ˆë‹¤ê³  ë³¼ ìˆ˜ ìˆê² ë‹¤.
// ì´ê±¸ ì¶”ê°€í•˜ê³ ë‚˜ì„ , ë‹¹ì—°íˆ ê¸°ì¡´ì˜ _stateê°€ ì‚¬ìš©ë˜ëŠ” ëª¨ë“  ê³³ì— Stateë¡œ ëŒ€ì²´í•´ì¤˜ì•¼ í•œë‹¤.
public PlayerState State
{
    get => _state;
    set
    {
        _state = value;

        Animator anim = GetComponent<Animator>();
        switch (_state)
        {
            case PlayerState.Die:
                anim.SetBool("attack", false);
                break;
            case PlayerState.Idle:
                anim.SetFloat("speed", 0);
                anim.SetBool("attack", false);
                break;
            case PlayerState.Moving:
                anim.SetFloat("speed", _stat.MoveSpeed);
                anim.SetBool("attack", false);
                break;
            case PlayerState.Skill:
                anim.SetBool("attack", true);
                break;
        }
    }
}
```

- ë§ˆìš°ìŠ¤ í¬ì¸í„°ë¥¼ ê¾¸ìš± ëˆ„ë¥´ê³  ìˆìœ¼ë©´ ì—°ì†ì ìœ¼ë¡œ ë•Œë¦¬ëŠ” ê¸°ëŠ¥ì€
    - `OnHitEvent()` í•¨ìˆ˜ ì•ˆì—ì„œ, í˜„ì¬ ë§ˆìš°ìŠ¤ í¬ì¸í„°ê°€ ëˆŒë ¤ì ¸ ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ê°€ì§€ê³  ê³µê²© ì• ë‹ˆë©”ì´ì…˜ì„ ë˜ ë°œìƒì‹œí‚¤ê±°ë‚˜, ê·¸ë ‡ì§€ ì•Šê²Œë” ë§Œë“¤ë©´ ë˜ê² ë‹¤.
    - ë¨¼ì €, `OnMouseEvent()` ë‚´ë¶€ì˜ êµ¬ì¡°ë¥¼ ìˆ˜ì •í•˜ì.
        - ê¸°ì¡´ì˜ `OnMouseEvent()` í•¨ìˆ˜ ë‚´ë¶€ëŠ” Stateê°€ Dieê°€ ì•„ë‹ˆë¼ë©´ Raycastë¥¼ í™œìš©í•˜ëŠ” ë¡œì§ì„ ê±°ì¹˜ì§€ë§Œ, ì´ëŠ” Stateê°€ Skillì¼ ë•Œë„ í•¨ìˆ˜ê°€ í˜¸ì¶œë  ìˆ˜ ìˆì–´ì„œ ë™ì¼í•˜ê²Œ ê±°ì¹  ìˆ˜ê°€ ìˆê³ , ê·¸ë ‡ê²Œ ëœë‹¤ë©´ ë¬¸ì œê°€ ë  ìˆ˜ ìˆë‹¤.
        - ê·¸ë˜ì„œ Raycast ë¡œì§ì€ Stateê°€ Idle í˜¹ì€ Movingì¼ ë•Œë§Œ ë™ì‘í•˜ë„ë¡ ìˆ˜ì •í•˜ê³ , Skill ì¼ ë•ŒëŠ” ë³„ë„ë¡œ ë™ì‘í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ êµ¬ì¡°ë¥¼ ìˆ˜ì •í•˜ì.
        
```csharp
// Raycast ë¡œì§ì€ Idle ìƒíƒœì™€ Moving ìƒíƒœì—ì„œë§Œ ë™ì‘í•˜ë¯€ë¡œ, ì´ë¥¼ ë‹´ë‹¹í•˜ëŠ” í•¨ìˆ˜(OnMouseEvent_IdleMoving)ë¡œ ë”°ë¡œ ë¹¼ì£¼ê³ , ê¸°ì¡´ì˜ OnMouseEvent í•¨ìˆ˜ëŠ” ë¶„ê¸°ì ì„ ë‹´ë‹¹í•˜ëŠ” í•¨ìˆ˜ë¡œ ì—­í• ì„ ë³€í™˜.

/// <summary>
/// ë§ˆìš°ìŠ¤ì˜ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
/// </summary>
/// <param name="mouseEvent">ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ì˜ íƒ€ì…</param>
void OnMouseEvent(Define.MouseEvent mouseEvent)
{
    switch (State)
    {
        case PlayerState.Idle:
            OnMouseEvent_IdleMoving(mouseEvent);
            break;
        case PlayerState.Moving:
            OnMouseEvent_IdleMoving(mouseEvent);
            break;
    }
}

void OnMouseEvent_IdleMoving(Define.MouseEvent mouseEvent)
{
    var ray = Camera.main.ScreenPointToRay(Input.mousePosition);
    bool raycastHit = Physics.Raycast(ray, out var hit, 100.0f, _mask);

    switch (mouseEvent)
    {
        case Define.MouseEvent.PointerDown:     // ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ëŠ” ìˆœê°„
        {
            // í¬ì¸í„°ê°€ ëª¬ìŠ¤í„°ì— ìˆê±°ë‚˜
            // í¬ì¸í„°ê°€ ë•…ì— ìˆê±°ë‚˜
            
            if (raycastHit)     // rayê°€ ë§ì€ ê³³ì— ë¬´ì¡°ê±´ ì´ë™ (ëª¬ìŠ¤í„°, ë•… êµ¬ë¶„ X)
            {
                _destPos = hit.point;
                State = PlayerState.Moving;        // ìƒíƒœ ë³€í™˜

                // ëª¬ìŠ¤í„°ì™€ ë•… êµ¬ë¶„
                if (hit.collider.gameObject.layer == (int)Define.Layer.Monster)
                    _lockTarget = hit.collider.gameObject;
                else
                    _lockTarget = null;
            }
        }
            break;
        case Define.MouseEvent.Press:       // ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ê³  ìˆëŠ” ìƒíƒœ
        {
            if (_lockTarget == null && raycastHit)        // _lockTargetì´ ì—†ê³  rayê°€ ë§ì€ ë•…ì˜ ì§€ì ìœ¼ë¡œ ì´ë™
                _destPos = hit.point;
        }
            break;  
    }
}
```
        
- ê·¸ë¦¬ê³  `OnHitEvent()` í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•´ë³´ì
    - ìŠ¤í‚¬ì„ ì“°ëŠ” ë„ì¤‘ì— ë§ˆìš°ìŠ¤ë¥¼ ë—€ë‹¤ë©´, ì´ëŠ” ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆì„ê¹Œ?
    - ë°©ê¸ˆ ìˆ˜ì •í•˜ë©´ì„œ ì—­í• ì´ ë³€í™”í•œ `OnMouseEvent` í•¨ìˆ˜ì•ˆì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤
        - `OnMouseEvent` í•¨ìˆ˜ ì•ˆì˜ switchë¬¸ì— PlayerState.Skillì¼ ë•Œì˜ ë¶„ê¸°ë¥¼ ì¶”ê°€í•˜ê³ , `ë§ˆìš°ìŠ¤ ë²„íŠ¼ì—ì„œ ì†ì„ ë—Œ`ì„ ì €ì¥í•˜ëŠ” bool ë³€ìˆ˜ `_stopSkill`ì„ë§Œë“¤ì–´ì£¼ì. 
        ê¸°ë³¸ê°’ì€ falseë¡œ ì¡ê³ , PlayerState.Skillì¼ ë•Œì˜ ë¶„ê¸°ë¬¸ì—ì„œ ì´ë¥¼ trueë¡œ ë°”ê¿”ì£¼ì.
        - ê·¸ë¦¬ê³  `OnHitEvent` í•¨ìˆ˜ ë‚´ì—ì„œ `_stopSkill`ì— ë”°ë¥¸ ì¡°ê±´ë¬¸ìœ¼ë¡œ trueë¼ë©´ Stateë¥¼ Idleë¡œ, falseë¼ë©´ Stateë¥¼ Skillë¡œ ë³€í™”ì‹œí‚¤ëŠ” ì½”ë“œë¥¼ ì§œê³  í…ŒìŠ¤íŠ¸.
            
            â‡’ ê·¸ëŸ¬ë©´ ì´ ë‘ êµ¬ë¬¸ì€, ëª¬ìŠ¤í„°ì™€ ì‹¸ìš°ëŠ” Skill Stateì¼ ë•Œ  ë™ì‘í•  ê²ƒì´ë‹¤. **ì‹¸ìš°ëŠ” ì¤‘ì— (Stateê°€ Skillì¼ ë•Œ), ë§ˆìš°ìŠ¤ë¥¼ ë—€ë‹¤ë©´ ì´ ë‹¤ìŒ ê³µê²©ì€ í•˜ì§€ ì•ŠëŠ”ë‹¤. (StateëŠ” Idleë¡œ ì „í™˜)**
                
- ëª¬ìŠ¤í„°ë¥¼ ì§§ê²Œ í´ë¦­í•˜ë©´, 1íšŒ ê³µê²© í›„ ì• ë‹ˆë©”ì´ì…˜ì´ ATTACKì—ì„œ ë©ˆì¶”ëŠ” ë²„ê·¸ê°€ ìƒê¸´ë‹¤.
    - ì •í™•íˆëŠ”, ìœ„ì—ì„œ êµ¬ë¶„í•œ 0.2ì´ˆ ë‚´ì˜ ì§§ì€ í´ë¦­ì´ ì•„ë‹ˆë”ë¼ë„, ëª¬ìŠ¤í„°ë¥¼ í´ë¦­í•˜ì—¬ ê³µê²©ì„ ì§€ì‹œí•˜ê³  ë§ˆìš°ìŠ¤ë¥¼ ë–¼ë©´ (ì´ë•Œ ë§ˆìš°ìŠ¤ëŠ” ëª¬ìŠ¤í„°ì—ê²Œ ë‹¤ê°€ê°€ ê³µê²©ì„ ì‹œì‘í•˜ê¸° ì „ì— ë—€ë‹¤) 
    ìœ„ì™€ ê°™ì€ ë²„ê·¸ê°€ ì¼ì–´ë‚œë‹¤.
    - ì´ëŠ”, ì²˜ìŒ `_stopSkill`ì„ trueë¡œ ì„¤ì •í•˜ì§€ ì•Šì•„ì„œ ìƒê¸´ ë¬¸ì œì´ë‹¤. ì²˜ìŒì— falseë¡œ ì´ˆê¸°í™”í•œ í›„, í•œë²ˆë„ trueë¡œ ì§€ì •í•˜ì§€ ì•Šì•„ì„œ `OnHitEvent` ì—ì„œë„ `State = PlayerState.**Skill**;` ì„ ì‹¤í–‰í•˜ë©´ì„œ, Skill ìƒíƒœì—ì„œ ë²—ì–´ë‚˜ì§€ ëª»í•œ ê²ƒì´ë‹¤.
        
        ê·¸ë˜ì„œ `OnMouseEvent_IdleMoving` í•¨ìˆ˜ ì•ˆì—ì„œ `MouseEvent` ê°€ `PointerUp`ì¼ë•Œì— ë”°ë¥¸ ë¶„ê¸°ë¥¼ ì¶”ê°€í•˜ê³ , ì´ ë•Œ `_stopSkill = true;` ë¥¼ í•´ì£¼ì.
            
        - ê·¸ë¦¬ê³  ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥¼ ë•Œ ì´ëŸ¬í•œ íŒ¨í„´ì„ ì‹œì‘ì‹œí‚¤ê¸° ìœ„í•´ `OnMouseEvent_IdleMoving` í•¨ìˆ˜ ë‚´ì—ì„œ, mouseEventê°€ `PointerDown` ì´ê³  ì´ë™í•˜ëŠ” ë¶€ë¶„ì— `_stopSkill = false;` ë¥¼ ì¶”ê°€í•´ì£¼ì.
    - ì—°ì†ê³µê²©ì€ ATTACK ì• ë‹ˆë©”ì´ì…˜ì˜ Import Settingsì—ì„œ LoopTimeì„ Trueë¡œ ìˆ˜ì •í•´ ì¤Œìœ¼ë¡œì¨ í•´ê²°.
- ê·¸ë¦¬ê³  ì´ì œëŠ” ì• ë‹ˆë©”ì´ì…˜ ê´€ë¦¬ë¥¼ ìœ ë‹ˆí‹° íˆ´ë¡œë¶€í„° ë¶„ë¦¬ì‹œì¼œë³´ì.
    - ì´ê²Œ ì½”ë“œë¡œ ê´€ë¦¬í•˜ëŠ”ë°ì—ëŠ” ì¢€ ë” í•©ë¦¬ì ì¸ ë°©ë²•.
    - ì• ë‹ˆë©”ì´ì…˜ì˜ ìˆ˜ê°€ ë§ì•„ì§ˆ ë•Œì—ë„ ì´ê²Œ ë” ê´€ë¦¬í•˜ê¸° ì‰¬ìš¸ ê²ƒì´ë‹¤.
    - í•˜ëŠ” ë°©ë²•ì€
        - Animator Windowë‚´ì˜ ëª¨ë“  Parameterë¥¼ ì§€ìš°ê³ ,
        - ëª¨ë“  Animation ê°„ì˜ Trasitionì„ ì§€ìš°ê³ 
        - `PlayerController.cs`ì˜ `State` í”„ë¡œí¼í‹°ì˜ setterê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤, `animator`ì˜ `Crossfade`ë¥¼ ì´ìš©í•´ ì• ë‹ˆë©”ì´ì…˜ì„ ì¬ìƒí•œë‹¤.
            
```csharp
public PlayerState State
{
    get => _state;
    set
    {
        _state = value;

        Animator anim = GetComponent<Animator>();
        switch (_state)
        {
            case PlayerState.Die:
                break;
            case PlayerState.Idle:
                anim.CrossFade("WAIT", 0.1f);
                break;
            case PlayerState.Moving:
                anim.CrossFade("RUN", 0.1f);
                break;
            case PlayerState.Skill:
                anim.CrossFade("ATTACK", 0.1f, -1, 0);    // ì´ë ‡ê²Œ ë£¨í”„ë¥¼ êµ¬í˜„.
                break;
        }
    }
}
```
        
- ê³µê²©í•  ë•Œì—ëŠ” ëª¬ìŠ¤í„°ë¥¼ ë˜‘ë°”ë¡œ ë°”ë¼ë³´ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆë‹¤. ì´ë¥¼ ê³ ì³ë³´ì
    
```csharp
// Playercontroller.cs ë‚´ë¶€
// Stateê°€ Skillì¼ ë•Œ Updateí•¨ìˆ˜ì—ì„œ UpdateSkillì„ ì‹¤í–‰ì‹œí‚¨ë‹¤.
void UpdateSkill()
{
    if (_lockTarget != null)
    {
				// ë³´ê°„ì„ í™œìš©í•´ì„œ ëŒ€ìƒì„ ë³´ë„ë¡.

        Vector3 dir = _lockTarget.transform.position - transform.position;
        Quaternion qua = Quaternion.LookRotation(dir);
        transform.rotation = Quaternion.Lerp(transform.rotation, qua, 20 * Time.deltaTime);
    }
}
```

## ì²´ë ¥ ê²Œì´ì§€ #1 & #2

- ê³µê²©ì„ í•˜ë©´ ì‹¤ì œ ì²´ë ¥ì„ ë‹³ê²Œ í•˜ê³ , ì²´ë ¥ ê²Œì´ì§€ ì‹œê°í™”
- ì´ëŠ” 2D UIê°€ ì•„ë‹Œ, World Space ìƒì˜ 3D UIë¡œ ë§Œë“¤ì.
    - ì´ëŠ” Canvas ì»´í¬ë„ŒíŠ¸ì˜ Render Modeë¥¼ World Spaceë¡œ ë°”ê¿”ì„œ ì„¤ì • ê°€ëŠ¥. Event Cameraë„ ë‹¹ì—°íˆ Main Cameraê°€ ë“¤ì–´ê°€ê²Œ í•´ì•¼ê² ì§€?
    - Scaleì€ 0.01ë¡œ ë§ì¶°ì£¼ë‹ˆê¹Œ ì ë‹¹í•œ í¬ê¸°ê°€ ëœ ê²ƒ ê°™ë‹¤. ìœ„ì¹˜ë„ ì ì ˆíˆ ì¡°ì •í•´ì£¼ê³ , Slider ìì‹ ì¤‘ Fill ì´ë¼ëŠ” ì˜¤ë¸Œì íŠ¸ì˜ ì´ë¯¸ì§€ ì»¬ëŸ¬ë¥¼ ë¶‰ê²Œ ìˆ˜ì •í•´ì£¼ë‹ˆ,
        
        ![Untitled (15)](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/8293e8b3-10a0-4043-b561-cbe868f9fd9a)
        
        ì´ë ‡ê²Œ ë‚˜ë¦„ ê·¸ëŸ´ë“¯í•œ ì²´ë ¥ë°”ì˜ ëª¨ìŠµì´ ëœ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.
        
        - ê·¸ëŸ°ë° ì§€ê¸ˆ ì € ì‚¬ì§„ì˜ ì²´ë ¥ë°”ëŠ” Sliderì˜ Valueë¥¼ 1ë¡œ, ê·¸ëŸ¬ë‹ˆê¹Œ ìµœëŒ€ë¡œ í‚¤ì› ëŠ”ë° ì•½ê°„ì˜ ì—¬ë°±ì´ ë‚¨ì•„ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ì´ëŠ” Handleì´ í•„ìš”ì—†ì–´ì„œ ì§€ì›Œì„œ ê·¸ëŸ°ê²ƒ ê°™ì€ë°, ì´ë¥¼ ê³ ì³ë³´ì
            
            ![Untitled (16)](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/eab76522-4d7c-4139-87f0-8ca30d29f57a)

            - FillAreaì˜ RectTransform ì¤‘ Leftì™€ Rightê°€ 0ì´ ì•„ë‹Œ, 5ì™€ 15ë¡œ ì„¤ì •ë˜ì–´ìˆëŠ”ë°, ë°”ë¡œ ì´ê²Œ ì›ì¸ì´ì—ˆë‹¤.
            - ê·¸ë˜ì„œ ì´ë¥¼ ëª¨ë‘ 0ìœ¼ë¡œ ì„¤ì •í•´ì£¼ë©´, Backgroundë³´ë‹¤ ì‚´ì§ ì‚ì ¸ë‚˜ì˜¤ê²Œ ë˜ëŠ”ë°, ì´ ë•Œ ê·¸ í•˜ìœ„ì˜ Fillì€ RectTransform > Leftì™€ Rightì´ -5ë¡œ ì„¤ì •ë˜ì–´ìˆì–´ì„œ ê·¸ë ‡ë‹¤. ì´ë¥¼ 0 ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì–´ ì •í™•íˆ ë§ì¶°ì£¼ì.
    - ì´ë ‡ê²Œ ë§Œë“  HPBarëŠ” `Resources > Prefabs > UI > WorldSpace` ê²½ë¡œì— í”„ë¦¬íŒ¹ìœ¼ë¡œ ì €ì¥í•˜ì.
    - ê·¸ë¦¬ê³  ì—¬ê¸°ì— ë§ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§ì¶°ì£¼ê¸° ìœ„í•´, `Scripts > UI > WorldSpace` ê²½ë¡œì— ë™ì¼í•œ ì´ë¦„(`UI_HPBar`)ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì£¼ì.
    - ê·¸ëŸ¬ë©´ `UI_HPBar.cs` ë¥¼ ì‘ì„±í•´ì£¼ê³ , ìƒˆë¡œìš´ í˜•íƒœì˜ UIë„ ê´€ë¦¬í•´ì¤˜ì•¼ í•˜ë‹ˆ `UI_Manager`ë¥¼ ìˆ˜ì •í•´ì¤˜ì•¼ê² ë‹¤.
        
```csharp
// UIManager.cs ìŠ¤í¬ë¦½íŠ¸ ë‚´ë¶€

/// <summary>
/// WorldSpace UI ìƒì„±ìš© í•¨ìˆ˜
/// </summary>
/// <param name="parent">ìƒˆë¡œ ìƒì„±ëœ ì„œë¸Œ ì•„ì´í…œì„ ì¶”ê°€í•  ë¶€ëª¨ Transform. nullì¼ ê²½ìš° ë¶€ëª¨ ì—†ì´ ìƒì„±ë¨.</param>
/// <param name="name">ì¸ìŠ¤í„´ìŠ¤í™”í•  Prefabì˜ ì´ë¦„. nullì´ë‚˜ ë¹ˆ ë¬¸ìì—´ì¼ ê²½ìš° Tì˜ í´ë˜ìŠ¤ ì´ë¦„ì„ ì‚¬ìš©.</param>
/// <typeparam name="T">ì„œë¸Œ ì•„ì´í…œì˜ íƒ€ì…ìœ¼ë¡œ, UI_Baseì„ í™•ì¥í•´ì•¼ í•¨.</typeparam>
/// <returns>ìƒì„±ëœ ì„œë¸Œ ì•„ì´í…œì˜ T íƒ€ì… ì»´í¬ë„ŒíŠ¸.</returns>
public T MakeWorldSpaceUI<T>(Transform parent = null, string name = null) where T : UI_Base
{
    if (string.IsNullOrEmpty(name))
        name = typeof(T).Name;

    GameObject go = Managers.Resource.Instantiate($"UI/WorldSpace/{name}");
    if(parent != null)
        go.transform.SetParent(parent);
    
    // WorldSpace ì„¤ì •
    Canvas canvas = go.GetComponent<Canvas>();
    canvas.renderMode = RenderMode.WorldSpace;
    canvas.worldCamera = Camera.main;
    
    return Util.GetOrAddComponent<T>(go);
}
```
        
- ê·¸ë¦¬ê³  ê°„ë‹¨í•˜ê²Œ ì´ë¥¼ ë¶ˆëŸ¬ì£¼ëŠ” ì½”ë“œë¥¼ `PlayerController.cs` ë‚´ë¶€ì— ì‘ì„±í•´, í…ŒìŠ¤íŠ¸í•´ë³´ì
    
![MMO_Unity-Game-WindowsMacLinux-Unity2022 3 16f1__DX11_2024-02-1814-14-55-ezgif com-optimize](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/93de63fb-60b4-46fa-845f-9ae6e3a7cba2)

- ì˜ ë“¤ì–´ì™”ì§€ë§Œ, UnityChanì˜ Transformì„ Parentë¡œ ë°›ì•„ì„œ Rotationì˜ ì˜í–¥ì„ ë°›ì•„ ì²´ë ¥ë°”ê°€ ë§ˆêµ¬ ë’¤ì§‘íŒë‹¤.
- ì´ë¥¼ ê³ ì³ë³´ì, ê·¸ë¦¬ê³  ì‹¤ì œ ì²´ë ¥ë„ ë°˜ì˜í•˜ê²Œë” ìˆ˜ì •í•´ë³´ì.
    
    **ë¹Œë³´ë“œ(Billboard)**ë¼ëŠ” ê°œë…ì´ ìˆë‹¤. ì´ëŠ” ê°ì²´ê°€ í•­ìƒ ì¹´ë©”ë¼ë¥¼ í–¥í•˜ë„ë¡ í•˜ëŠ” ê¸°ìˆ ì¸ë°, ì£¼ë¡œ í…ìŠ¤ì²˜ì™€ ê°™ì€ ë¬¼ì²´ê°€ ê´€ì°°ìì˜ ì‹œì ì—ì„œ í•­ìƒë™ì¼í•˜ê²Œ ë³´ì´ë„ë¡ í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤. 
    ì¼ë°˜ì ìœ¼ë¡œ ë§ì´ ì ‘í–ˆë˜ ì²´ë ¥ë°”ëŠ” ë°”ë¡œ ì´ë ‡ê²Œ ë¹Œë³´ë“œë¼ëŠ” ê°œë…ì„ í™œìš©í•´ êµ¬í˜„ë˜ì—ˆë˜ ê²ƒì´ë‹¤. ì´ ì²´ë ¥ë°”ë„ ë°”ë¡œ ë¹Œë³´ë“œë¡œ ë°”ê¿”ë³´ì.
        
```csharp
public class UI_HPBar : UI_Base
{
    enum GameObjects
    {
        HPBar,
    }

    private Transform parent;
    private Collider _parentCollider;
    private Stat _stat;
    private Slider _slider;

    public override void Init()
    {
        Bind<GameObject>(typeof(GameObjects));

        parent = transform.parent;
        _parentCollider = parent.GetComponent<Collider>();
        _stat = parent.GetComponent<Stat>();
        _slider = GetObject((int)GameObjects.HPBar).gameObject.GetComponent<Slider>();
    }

    private void Update()
    {
        // ì²´ë ¥ë°”ì˜ ìœ„ì¹˜ì™€ íšŒì „ì„ ì½”ë“œë¡œ ì¡°ì •
        // í”Œë ˆì´ì–´ ìºë¦­í„°ì˜ ì¶©ëŒì²´ ë†’ì´ë³´ë‹¤ ì‚´ì§ ë” ìœ„ë¡œ ë„ì›Œì„œ
        transform.position = parent.position + Vector3.up * (_parentCollider.bounds.size.y + 0.2f);

        // ì²´ë ¥ë°”ì˜ íšŒì „ê°’ì„ ì¹´ë©”ë¼ì™€ ë™ì¼í•˜ê²Œ
        transform.rotation = Camera.main.transform.rotation;
        // transform.lookAt(Camera.main.transform) ëŠ” ì²´ë ¥ë°”ì˜ ì¢Œìš°ê°€ ë’¤ì§‘íŒë‹¤.

        // ì‹¤ì œ ì²´ë ¥ê³¼ sliderë¥¼ ë™ê¸°í™”
        float ratio = _stat.MaxHp == 0 ? 0 : (_stat.Hp / (float)_stat.MaxHp);        // ì†Œìˆ˜ë¶€ ì†Œì‹¤ë°©ì§€ë¥¼ ìœ„í•œ íƒ€ì… ìºìŠ¤íŒ…
        SetHpRatio(ratio);
    }

    void SetHpRatio(float ratio)
    {
        _slider.value = ratio;
    }
}
```
        
- ëª¬ìŠ¤í„°ë„ ì²´ë ¥ë°”ê°€ ë³´ì—¬ì•¼í•˜ë‹ˆ, ì´ë¥¼ ë¶™ì—¬ì£¼ì. ëª¬ìŠ¤í„°ì—ê²ŒëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì—†ìœ¼ë‹ˆ, íˆ´ë¡œ ê°•ì œë¡œ ë¶™ì—¬ì£¼ê³ , ì´ëŸ´ë•ŒëŠ” ìŠ¤í¬ë¦½íŠ¸ë„ ì§ì ‘ ë¶™ì—¬ì£¼ì.
- ì´ì œëŠ” ì‹¤ì œë¡œ ê³µê²©í•  ë•Œ ì²´ë ¥ì´ ê¹ì´ë„ë¡ í•˜ì. ê·¸ëŸ¬ë©´ ì‹œê°í™”í•˜ëŠ” ë¶€ë¶„ì€ ë§Œë“¤ì–´ë†“ì•˜ìœ¼ë‹ˆ, ì²´ë ¥ì´ ë³€í•œë‹¤ë©´ ë³€í•œ ì²´ë ¥ì„ ì•Œì•„ì„œ ì˜ ë³´ì—¬ì¤„ ê²ƒì´ë‹¤.
        
```csharp
// PlayerController.cs ë‚´ë¶€

/// <summary>
/// Skill stateì¼ë•Œì˜ Animation Event Callback í•¨ìˆ˜
/// </summary>
private void OnHitEvent()
{
    Debug.Log("On Hit Event!");
    
    // TODO ì ì˜ ì²´ë ¥ì„ ê¹ëŠ”ë‹¤.
    if (_lockTarget != null)
    {
        Stat targetStat = _lockTarget.GetComponent<Stat>();
        int damage = _stat.Attack - targetStat.Defense;
        targetStat.Hp -= (damage) <= 0 ? 1 : damage;    // ë°ë¯¸ì§€ê°€ ìµœì†Œ 1ì€ ë“¤ì–´ê°€ê²Œë”
        
        DebugEx.Log($"Damage : {damage}");
    }

    // TODO ë§ˆìš°ìŠ¤ë¥¼ ë†“ìœ¼ë©´, ê³µê²©ì„ ë©ˆì¶”ê³  ì›€ì§ì¸ë‹¤.
    // TODO ë§ˆìš°ìŠ¤ë¥¼ ê³„ì† ëˆ„ë¥´ê³  ìˆë‹¤ë©´ ì—°ì† ê³µê²©

    if (_stopSkill)     // ê³µê²©ì„ ë©ˆì¶”ê±°ë‚˜
    {
        State = PlayerState.Idle;
    }
    else                // ì—°ì†ê³µê²©ì„ í•˜ê±°ë‚˜
    {
        State = PlayerState.Skill;
    }
}
```

## ëª¬ìŠ¤í„° AI #1 & #2

- ëª¬ìŠ¤í„°ê°€ ì¼ì • ê±°ë¦¬ ì•ˆì˜ í”Œë ˆì´ì–´ë¥¼ ì¸ì‹í•˜ê³ , ë”°ë¼ì™€ì„œ ê³µê²©í•˜ëŠ” AIë¥¼ êµ¬í˜„í•´ë³´ì
- ìƒê°í•´ë³´ë©´, ëª¬ìŠ¤í„°ì»¨íŠ¸ë¡¤ëŸ¬ ìŠ¤í¬ë¦½íŠ¸ë„ í”Œë ˆì´ì–´ì™€ ë§ì€ ë¶€ë¶„ì„ ê³µí†µìœ¼ë¡œ ê°€ì§ˆ ê²ƒì´ë‹¤. `(Stateë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ìºë¦­í„° ê´€ë¦¬)`
- ê·¸ëŸ° ì ì„ ê³ ë ¤í–ˆì„ ë•Œ, ê³µí†µì ì¸ ë¶€ë¶„ì„ `BaseController`ë¼ëŠ” í´ë˜ìŠ¤ë¡œ ë¹¼ì„œ êµ¬í˜„í•˜ê³ , ëª¬ìŠ¤í„°ì™€ í”Œë ˆì´ì–´ê°€ ê°ê° ìƒì†ë°›ì•„ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ”ê±´ ì–´ë–¨ê¹Œ?

#### BaseController.cs
```csharp
// BaseControllerë¥¼ ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ëŠ” Init ë©”ì„œë“œë¥¼ ë¬´ì¡°ê±´ êµ¬í˜„í•˜ë„ë¡ ì¶”ìƒ í´ë˜ìŠ¤ì™€ ì¶”ìƒ ë©”ì„œë“œë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.
public abstract class BaseController : MonoBehaviour
{
    [SerializeField] protected Vector3 _destPos;
    
    [SerializeField] protected Define.State _state = Define.State.Idle;

    [SerializeField] protected GameObject _lockTarget;

    // ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ì—ì„œ ì´ë¥¼ ì¬ì •ì˜í•  ìˆ˜ ìˆë„ë¡ virtual
    public virtual Define.State State
    {
        get => _state;
        set
        {
            _state = value;

            Animator anim = GetComponent<Animator>();
            switch (_state)
            {
                case Define.State.Die:
                    break;
                case Define.State.Idle:
                    anim.CrossFade("WAIT", 0.1f);
                    break;
                case Define.State.Moving:
                    anim.CrossFade("RUN", 0.1f);
                    break;
                case Define.State.Skill:
                    anim.CrossFade("ATTACK", 0.1f, -1, 0);
                    break;
            }
        }
    }

    private void Start()
    {
        Init();
    }

    private void Update()
    {
        switch (State)
        {
            case Define.State.Die:
                UpdateDie();
                break;
            case Define.State.Moving:
                UpdateMoving();
                break;
            case Define.State.Idle:
                UpdateIdle();
                break;
            case Define.State.Skill:
                UpdateSkill();
                break;
        }
    }

    // ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ì—ì„œ êµ¬í˜„í•´ì•¼í•˜ë„ë¡ ì¶”ìƒ ë©”ì„œë“œ
    public abstract void Init();

    // ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ì—ì„œ ì¬ì •ì˜í•  ìˆ˜ ìˆë„ë¡ ê°€ìƒ ë©”ì„œë“œ
    protected virtual void UpdateDie() { }
    protected virtual void UpdateMoving() { }
    protected virtual void UpdateIdle() { }
    protected virtual void UpdateSkill() { }
}
```
    
- ìˆ˜ì •í•œ `PlayerController.cs`, ì—¬ê¸°ì—ëŠ” `PlayerController`ì— ì¢…ì†ì ì¸ ë¶€ë¶„ë§Œ ë‚¨ì•„ìˆë‹¤.
    
```csharp
public class PlayerController : BaseController
{
    // ë§ˆìš°ìŠ¤ í´ë¦­ì— ë°˜ì‘ í•  ë ˆì´ì–´ë§Œ ë§ˆìŠ¤í‚¹
    private int _mask = (1 << (int)Define.Layer.Ground) | (1 << (int)Define.Layer.Monster);
    
    [SerializeField] private PlayerStat _stat;
    private bool _stopSkill = false;

    private NavMeshAgent navMeshAgent;

    public override void Init()
    {
        // ê¸°ì¡´ì˜ _speed ë³€ìˆ˜ ëŒ€ì‹ , PlayerStatì„ ì´ìš©í•œë‹¤.
        _stat = GetComponent<PlayerStat>();
        
        // InputManagerì—ì„œ Event í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë„ë¡ ë§¡ê¸´ë‹¤.
        Managers.Input.MouseAction -= OnMouseEvent;
        Managers.Input.MouseAction += OnMouseEvent;
        if(gameObject.GetComponentInChildren<UI_HPBar>() == null)
            Managers.UI.MakeWorldSpaceUI<UI_HPBar>(transform);
        
        navMeshAgent = gameObject.GetOrAddComponent<NavMeshAgent>();
    }

    protected override void UpdateMoving()
    {
        // ëª¬ìŠ¤í„°ê°€ ë‚´ ì‚¬ì •ê±°ë¦¬ ë‚´ì— ì¡´ì¬í•œë‹¤ë©´, ê³µê²©
        if (_lockTarget != null)
        {
            float distance = (_destPos - transform.position).magnitude;

            if (distance <= 2.0f)      // ëª¬ìŠ¤í„°ì™€ì˜ ê±°ë¦¬ê°€ ë‚´ ì‚¬ì •ê±°ë¦¬ ë‚´ì— ë“¤ì–´ì˜¨ë‹¤ë©´
            {
                State = Define.State.Skill;     // ìƒíƒœë¥¼ ê³µê²©ìƒíƒœë¡œ ë³€í™”ì‹œí‚¨ë‹¤
                return;                         // ë‚˜ë¨¸ì§€ ë¡œì§ì€ ì‹¤í–‰ X
            }
        }
        
        // ë‚´ ì‚¬ì •ê±°ë¦¬ì— ëª¬ìŠ¤í„°ê°€ ì—†ë‹¤ë©´, ë‹¨ìˆœ ì´ë™
        Vector3 dir = _destPos - transform.position;
        if (dir.magnitude < 0.1f)   // ê±°ë¦¬ëŠ” float, ì´ë ‡ê²Œ ë§¤ìš° ì ì€ ì˜¤ì°¨ì— ë“ ë‹¤ë©´ ë„ì°©í•œê²ƒìœ¼ë¡œ ê°„ì£¼.
        {
            State = Define.State.Idle;
        }   
        else    // ê·¸ë ‡ì§€ ì•Šë‹¤ë©´, ì•„ì§ ë„ì°©í•˜ì§€ ì•Šì€ê²ƒì´ë‹ˆ ì´ë™í•˜ë„ë¡.
        {
            // NavMeshë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì´ë™
            // NavMeshAgent navMeshAgent = gameObject.GetOrAddComponent<NavMeshAgent>();
            //
            // float moveDist = Mathf.Clamp(_stat.MoveSpeed * Time.deltaTime, 0, dir.magnitude);
            // navMeshAgent.Move(moveDist * dir.normalized);
            
            // Raycastë¡œ ë°”ë¡œ ì•ì´ ì¥ì• ë¬¼ë¡œ ë§‰íŒ ê³³ì¸ì§€ ì•„ë‹Œì§€ ê²€ì‚¬
            Debug.DrawRay(transform.position + Vector3.up * 0.5f, dir.normalized, Color.green);
            if(Physics.Raycast(transform.position, dir, 1, LayerMask.GetMask("Block"))) 
            {
                if(Input.GetMouseButton(0) == false)        // ìºë¦­í„° ì „ë°©ì— ì¥ì• ë¬¼ì´ ìˆê³  && ë§ˆìš°ìŠ¤ ë²„íŠ¼ì´ ëˆŒë¦¬ì§€ ì•Šìœ¼ë©´
                    State = Define.State.Idle;
                return;
            }
            
            float moveDist = Mathf.Clamp(_stat.MoveSpeed * Time.deltaTime, 0, dir.magnitude);
            transform.position += dir.normalized * moveDist;
            transform.rotation =
                Quaternion.Slerp(transform.rotation, Quaternion.LookRotation(dir), 10 * Time.deltaTime);    // ë„ì°©ì§€ë¥¼ ë°”ë¼ë³´ë„ë¡.
        }
    }

    protected override void UpdateSkill()
    {
        if (_lockTarget != null)
        {
            // ê³µê²©ì„ í•  ë•ŒëŠ” ëŒ€ìƒì„ ì •ë©´ìœ¼ë¡œ ë°”ë¼ë³¸ ì±„ë¡œ ê³µê²©í•  ê²ƒ
            Vector3 dir = _lockTarget.transform.position - transform.position;
            Quaternion qua = Quaternion.LookRotation(dir);
            transform.rotation = Quaternion.Lerp(transform.rotation, qua, 20 * Time.deltaTime);
        }
    }

    /// <summary>
    /// Skill stateì¼ë•Œì˜ Animation Event Callback í•¨ìˆ˜
    /// </summary>
    private void OnHitEvent()
    {
        Debug.Log("On Hit Event!");
        
        // TODO ì ì˜ ì²´ë ¥ì„ ê¹ëŠ”ë‹¤.
        if (_lockTarget != null)
        {
            Stat targetStat = _lockTarget.GetComponent<Stat>();
            int damage = _stat.Attack - targetStat.Defense;
            targetStat.Hp -= (damage) <= 0 ? 1 : damage;    // ë°ë¯¸ì§€ê°€ ìµœì†Œ 1ì€ ë“¤ì–´ê°€ê²Œë”
        }

        // TODO ë§ˆìš°ìŠ¤ë¥¼ ë†“ìœ¼ë©´, ê³µê²©ì„ ë©ˆì¶”ê³  ì›€ì§ì¸ë‹¤.
        // TODO ë§ˆìš°ìŠ¤ë¥¼ ê³„ì† ëˆ„ë¥´ê³  ìˆë‹¤ë©´ ì—°ì† ê³µê²©

        if (_stopSkill)     // ê³µê²©ì„ ë©ˆì¶”ê±°ë‚˜
        {
            State = Define.State.Idle;
        }
        else                // ì—°ì†ê³µê²©ì„ í•˜ê±°ë‚˜
        {
            State = Define.State.Skill;
        }
    }
    
    /// <summary>
    /// ë§ˆìš°ìŠ¤ì˜ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
    /// </summary>
    /// <param name="mouseEvent">ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ì˜ íƒ€ì…</param>
    void OnMouseEvent(Define.MouseEvent mouseEvent)
    {
        switch (State)
        {
            case Define.State.Idle:
                OnMouseEvent_IdleMoving(mouseEvent);
                break;
            case Define.State.Moving:
                OnMouseEvent_IdleMoving(mouseEvent);
                break;
            case Define.State.Skill:
            {
                if (mouseEvent == Define.MouseEvent.PointerUp)
                    _stopSkill = true;
            }
                break;
        }
    }

    void OnMouseEvent_IdleMoving(Define.MouseEvent mouseEvent)
    {
        var ray = Camera.main.ScreenPointToRay(Input.mousePosition);
        bool raycastHit = Physics.Raycast(ray, out var hit, 100.0f, _mask);

        switch (mouseEvent)
        {
            case Define.MouseEvent.PointerDown:     // ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ëŠ” ìˆœê°„
            {
                // í¬ì¸í„°ê°€ ëª¬ìŠ¤í„°ì— ìˆê±°ë‚˜ ë•…ì— ìˆê±°ë‚˜
                
                if (raycastHit)     // rayê°€ ë§ì€ ê³³ì— ë¬´ì¡°ê±´ ì´ë™ (ëª¬ìŠ¤í„°, ë•… êµ¬ë¶„ X)
                {
                    _destPos = hit.point;
                    State = Define.State.Moving;        // ìƒíƒœ ë³€í™˜
                    _stopSkill = false;

                    if (hit.collider.gameObject.layer == (int)Define.Layer.Monster)
                        _lockTarget = hit.collider.gameObject;      // ëª¬ìŠ¤í„°ë¼ë©´ ëŒ€ìƒ ê³ ì •
                    else
                        _lockTarget = null;                         // ë•…ì´ë¼ë©´ ê³ ì • X
                }
            }
                break;
            case Define.MouseEvent.Press:       // ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ê³  ìˆëŠ” ìƒíƒœ
            {
                if (_lockTarget == null && raycastHit)        // _lockTargetì´ ì—†ê³  rayê°€ ë•…ì— ë§ì•˜ë‹¤ë©´
                    _destPos = hit.point;                     // ì´ë™
            }
                break;
            case Define.MouseEvent.PointerUp:
                _stopSkill = true;
                break;
        }
    }
}
```
    
#### MonsterController.cs
    
```csharp
public class MonsterController : BaseController
{
    private Stat _stat;

    [SerializeField]
    private float _scanRange = 10;

    [SerializeField]
    private float _attackRange = 2;

    public override void Init()
    {
        _stat = GetComponent<Stat>();
        
        if(gameObject.GetComponentInChildren<UI_HPBar>() == null)
            Managers.UI.MakeWorldSpaceUI<UI_HPBar>(transform);
    }

    protected override void UpdateIdle()
    {
        Debug.Log("Monster UpdateIdle");
        
        // TODO : ë§¤ë‹ˆì €ê°€ ìƒê¸°ë©´ ì˜®ê¸°ì
        // ìœ„ì¹˜ì™€ ê±°ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”Œë ˆì´ì–´ê°€ ì¼ì • ê±°ë¦¬ ì•ˆì— ë“¤ì–´ì™”ëŠ”ì§€ ì—¬ë¶€ë¥¼ íŒë‹¨
        
        GameObject player = GameObject.FindGameObjectWithTag("Player");
        if (player == null)
            return;

        float distance = (player.transform.position - transform.position).magnitude;
        if (distance <= _scanRange)     // í”Œë ˆì´ì–´ê°€ ì¼ì • ê±°ë¦¬ì•ˆì— ë“¤ì–´ì˜´
        {
            _lockTarget = player;           // í”Œë ˆì´ì–´ë¥¼ ëª©í‘œë¡œ ì›€ì§ì´ë„ë¡ í•œë‹¤. ì¶”ì .
            State = Define.State.Moving;
            return;
        }
    }
    
    protected override void UpdateMoving()
    {
        // í”Œë ˆì´ì–´ê°€ ë‚´ ì‚¬ì •ê±°ë¦¬ì•ˆì— ë“¤ì–´ì˜¤ë©´ ê³µê²©
        if (_lockTarget != null)
        {
            _destPos = _lockTarget.transform.position;
            float distance = (_destPos - transform.position).magnitude;

            if (distance <= _attackRange)      // í”Œë ˆì´ì–´ì™€ì˜ ê±°ë¦¬ê°€ ë‚´ ì‚¬ì •ê±°ë¦¬ ë‚´ì— ë“¤ì–´ì˜¨ë‹¤ë©´
            {
                // í”Œë ˆì´ì–´ë¥¼ ì•ˆ ë°€ë„ë¡ NavMeshAgentì˜ ëª©ì ì§€ë¥¼ ì´ˆê¸°í™”
                NavMeshAgent navMeshAgent = gameObject.GetOrAddComponent<NavMeshAgent>();
                navMeshAgent.SetDestination(transform.position);
                
                State = Define.State.Skill;     // ìƒíƒœë¥¼ ê³µê²©ìƒíƒœë¡œ ë³€í™”ì‹œí‚¨ë‹¤
                return;                         // ë‚˜ë¨¸ì§€ ë¡œì§ì€ ì‹¤í–‰ X
            }
        }
        
        // í”Œë ˆì´ì–´ê°€ ê³µê²© ì‚¬ê±°ë¦¬ì•ˆì—ëŠ” ì—†ì„ ë•Œ
        Vector3 dir = _destPos - transform.position;
        if (dir.magnitude < 0.1f)   // ê±°ë¦¬ëŠ” float, ì´ë ‡ê²Œ ë§¤ìš° ì ì€ ì˜¤ì°¨ì— ë“ ë‹¤ë©´ ë„ì°©í•œê²ƒìœ¼ë¡œ ê°„ì£¼.
        {
            State = Define.State.Idle;
        }   
        else    // ê·¸ë ‡ì§€ ì•Šë‹¤ë©´, ì•„ì§ ë„ì°©í•˜ì§€ ì•Šì€ê²ƒì´ë‹ˆ ì´ë™í•˜ë„ë¡.
        {
            NavMeshAgent navMeshAgent = gameObject.GetOrAddComponent<NavMeshAgent>();

            // NavMeshAgentë¥¼ ì´ìš©í•´ì„œ ì•Œì•„ì„œ ëª©ì ì§€ê¹Œì§€ ê°€ë„ë¡.
            navMeshAgent.SetDestination(_destPos);      // ì´ëŠ” í”Œë ˆì´ì–´ë¥¼ ìê¾¸ ë°€ì¹œë‹¤.

            navMeshAgent.speed = _stat.MoveSpeed;
            
            transform.rotation =
                Quaternion.Slerp(transform.rotation, Quaternion.LookRotation(dir), 10 * Time.deltaTime);    // ë„ì°©ì§€ë¥¼ ë°”ë¼ë³´ë„ë¡.
        }
    }

    protected override void UpdateSkill()
    {
        if (_lockTarget != null)
        {
            // ê³µê²©ì„ í•  ë•ŒëŠ” ëŒ€ìƒì„ ì •ë©´ìœ¼ë¡œ ë°”ë¼ë³¸ ì±„ë¡œ ê³µê²©í•  ê²ƒ
            Vector3 dir = _lockTarget.transform.position - transform.position;
            Quaternion qua = Quaternion.LookRotation(dir);
            transform.rotation = Quaternion.Lerp(transform.rotation, qua, 20 * Time.deltaTime);
        }
    }

    void OnHitEvent()
    {
        if (_lockTarget != null)
        {
            Stat targetStat = _lockTarget.GetComponent<Stat>();
            int damage = _stat.Attack - targetStat.Defense;
            targetStat.Hp -= (damage) <= 0 ? 1 : damage;    // ë°ë¯¸ì§€ê°€ ìµœì†Œ 1ì€ ë“¤ì–´ê°€ê²Œë”
            
            // ë°ë¯¸ì§€ë¥¼ ì£¼ê³ , 
            if (targetStat.Hp > 0)      // í”Œë ˆì´ì–´ê°€ ì‚´ì•„ìˆìœ¼ë©´
            {
                // ì—¬ì „íˆ ë‚´ ì‚¬ì •ê±°ë¦¬ì— ìˆìœ¼ë©´ í•œëŒ€ ë” ë•Œë¦¬ê³ ,
                // ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë”°ë¼ê°€ì•¼ì§€

                float distance = (_lockTarget.transform.position - transform.position).magnitude;
                if (distance < _attackRange)
                    State = Define.State.Skill;
                else
                    State = Define.State.Moving;
            }
            else                        // í”Œë ˆì´ì–´ê°€ ì£½ì—ˆìœ¼ë©´ ëª¬ìŠ¤í„°ëŠ” Idleìƒíƒœë¡œ ëŒì•„ê°„ë‹¤
            {
                _state = Define.State.Idle;
            }
        }
        else
        {
            State = Define.State.Idle;
        }
    }
}
```

## Destroy #1 & #2

- ë©€í‹° í”Œë ˆì´ë‚˜, MMORPGì™€ ê°™ì€ ê²Œì„ì„ ë§Œë“ ë‹¤ê³  í•œë‹¤ë©´, ëª¬ìŠ¤í„°ëŠ” Sceneì— í”„ë¦¬íŒ¹ì„ ëŒì–´ë‹¤ ë°°ì¹˜í•˜ì§€ ì•Šê³  ë‚˜ë¦„ì˜ ì²´ê³„ê°€ í•„ìš”í•  ê²ƒ.
    - í”Œë ˆì´ì–´ê°€ ë§Œì•½ì— ëª¬ìŠ¤í„°ë¥¼ ê³µê²©í•œë‹¤ê³ í•˜ë©´
        - í”Œë ˆì´ì–´ê°€ íŠ¹ì •í•œ ëª¬ìŠ¤í„°ë¥¼ ê³µê²©í•œë‹¤ëŠ” ì •ë³´ë¥¼ ì„œë²„ì— ì „ë‹¬í•˜ê³ 
        - ì„œë²„ëŠ” ìˆ˜ì‹ í•œ ì •ë³´ì— ë§ê²Œ ì ì ˆí•œ ì—°ì‚°ì„ ì²˜ë¦¬í•´ ì¤„ ê²ƒì´ê³ ,
        - ì¸ì ‘í•œ í”Œë ˆì´ì–´ë“¤ì—ê²Œë„ ì´ë¥¼ ì •ìƒì ìœ¼ë¡œ ë³´ì—¬ì¤„ ìˆ˜ ìˆì–´ì•¼í•  ê²ƒì´ë‹¤.
        - â‡’ ê·¸ëŸ¬í•œ ë§¥ë½ì—ì„œ ì•„ì´ë””(ID)ë¥¼ í™œìš©í•´ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•´ë³´ì.
- `MonsterController.cs`ì—ì„œ, í”Œë ˆì´ì–´ë¥¼ ê³µê²©í•˜ê³ ë‚˜ì„œ í”Œë ˆì´ì–´ì˜ ì²´ë ¥ì´ 0 ì´í•˜ê°€ ë  ë•Œ í”Œë ˆì´ì–´ `GameObject`ë¥¼ `Destroy`í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤.
    
```csharp
void OnHitEvent()
{
    if (_lockTarget != null)
    {
        Stat targetStat = _lockTarget.GetComponent<Stat>();
        int damage = _stat.Attack - targetStat.Defense;
        targetStat.Hp -= (damage) <= 0 ? 1 : damage;    // ë°ë¯¸ì§€ê°€ ìµœì†Œ 1ì€ ë“¤ì–´ê°€ê²Œë”
        
        // ìƒëŒ€ë°©ì˜ ì²´ë ¥ì´ 0ì´í•˜ê°€ ëœë‹¤ë©´ ì‚¬ë¼ì§„ë‹¤.
        if(targetStat.Hp <= 0)
            Destroy(targetStat.gameObject);
            
        // ë°ë¯¸ì§€ë¥¼ ì£¼ê³ , 
        if (targetStat.Hp > 0)      // í”Œë ˆì´ì–´ê°€ ì‚´ì•„ìˆìœ¼ë©´
        {
            // ì—¬ì „íˆ ë‚´ ì‚¬ì •ê±°ë¦¬ì— ìˆìœ¼ë©´ í•œëŒ€ ë” ë•Œë¦¬ê³ ,
            // ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë”°ë¼ê°€ì•¼ì§€

            float distance = (_lockTarget.transform.position - transform.position).magnitude;
            if (distance < _attackRange)
                State = Define.State.Skill;
            else
                State = Define.State.Moving;
        }
        else                        // í”Œë ˆì´ì–´ê°€ ì£½ì—ˆìœ¼ë©´ ëª¬ìŠ¤í„°ëŠ” Idleìƒíƒœë¡œ ëŒì•„ê°„ë‹¤
        {
            _state = Define.State.Idle;
        }
    }
    else
    {
        State = Define.State.Idle;
    }
}
```
    
- ì´ë ‡ê²Œ í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë‹ˆ ë²„ê·¸ê°€ ë°œìƒí–ˆë‹¤!
    
    ![Untitled (17)](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/f667ac98-afff-415e-812f-7547eb66e562)
    
    `MissingReferenceException`ì´ ë°œìƒí–ˆë‹¤.
    
    - ì™œ ë°œìƒí–ˆì„ê¹Œ?
    - ë¡œê·¸ë¥¼ ì½ì–´ë³´ë©´,
        
        <aside>
        ğŸš« MissingReferenceException: The object of type 'GameObject' has been destroyed but you are still trying to access it.
        Your script should either check if it is null or you should not destroy the object.
        </aside>
        
    - GameObject íƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸ëŠ” íŒŒê´´ë˜ì—ˆëŠ”ë°, ì—¬ì „íˆ ì ‘ê·¼í•˜ë ¤ê³  í•´ì„œ ë¬¸ì œê°€ ë˜ëŠ” ëª¨ì–‘ì´ë‹¤.
        
    - ê·¸ë¦¬ê³ ëŠ” ìŠ¤í¬ë¦½íŠ¸ê°€ ì´ë¥¼ í™•ì¸í•´ì¤˜ì•¼ í•œë‹¤ê³  ê²½ê³ í•˜ëŠ”ë°, ì´ë¥¼ ì¢€ ë” ìì„¸íˆ ì‚´í´ë³´ê¸° ìœ„í•´ ë””ë²„ê·¸ë¥¼ ëŒë ¤ë³´ì
        
        ![Untitled (18)](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/47a62bef-5561-41ce-aca6-0574ac82a65f)
        
        ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê³³ì— ì´ë ‡ê²Œ ì‘ì„±í•˜ê³  BreakPointë¥¼ ê±¸ì–´ì„œ ë””ë²„ê·¸ ëª¨ë“œë¡œ ì§„ì…í•´ë³´ë©´
        
        ![Untitled (19)](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/35bdc99f-35f0-4b3a-91ea-91325a529883)
        
        ì´ë ‡ê²Œ _playerê°ì²´ê°€ nullì´ë¼ê³  í•œë‹¤. ê·¸ëŸ°ë° ë­”ê°€ ì´ìƒí•˜ë‹¤.
        
        ![Untitled (20)](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/e49cd18f-eb2e-4d12-9bd9-6df292e6352c)

        ì»´í“¨í„°í•™ê³¼ì—ì„œ ì—¬íƒœê¹Œì§€ ë°°ìš´ nullì€ ë°”ë¡œ ì´ë ‡ê²Œ ìƒê¸´ nullì¸ë°, ìœ„ì—ì„œ ë³´ì—¬ì¤€ nullì€ ë§ˆì¹˜ stringì²˜ëŸ¼ í°ë”°ì˜´í‘œë¡œ í‘œì‹œë˜ì–´ìˆëŠ”ê²ƒì´ êµ‰ì¥íˆ ë¬˜í•˜ë‹¤. ì €ê±´ ë­˜ê¹Œ?
        
        ê·¸ë¦¬ê³  ìƒê°í•´ë³´ë©´, ë§Œì•½ì— C++ì˜€ë‹¤ë©´ `_player`ëŠ” Dangling Referenceê°€ ë˜ì—ˆì„ ê²ƒì´ë‹¤. ìœ„ `CameraController`ì—ì„œëŠ” ì´ë¥¼ ë ˆí¼ëŸ°ìŠ¤ë¡œ ì°¸ì¡°í•˜ê³  ìˆëŠ” ìƒíƒœì—ì„œ ë ˆí¼ëŸ°ìŠ¤ì˜ `PlayerController` ì¸ìŠ¤í„´ìŠ¤ê°€ ì‚¬ë¼ì¡Œìœ¼ë‹ˆ.
        
        ê·¸ëŸ¬ë‚˜ ì–´ì§¸ì„ ê°€ â€˜íŒŒê´´â€™ë˜ì—ˆë‹¤ëŠ” `GameObject`ëŠ” ì‚¬ë¼ì§„ ê²ƒì´ ì•„ë‹ˆê³ , ê·¸ë ‡ë‹¤ê³  ê·¸ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ í•˜ë ¤ê³  í•˜ë©´ ì˜¤ë¥˜ê°€ ì™œ ìƒê¸°ëŠ” ê²ƒì¼ê¹Œ?
        
        ![Untitled (21)](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/277b6af6-750d-4f91-9c92-9a23b13e26d0)
        
        `GameObject` í´ë˜ìŠ¤ì˜ ì •ì˜ë¥¼ ì‚´í´ë³´ë©´ `Object`ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.
        
        > Object í´ë˜ìŠ¤ëŠ” Unity ì—”ì§„ì˜ ëª¨ë“  ê°ì²´ê°€ ìƒì†ë°›ëŠ” ê¸°ë³¸ í´ë˜ìŠ¤ë‹¤.
        
        ê·¸ë¦¬ê³  `Object`í´ë˜ìŠ¤ì—ì„œ ë‹¤ìŒì„ ì°¾ì„ ìˆ˜ ìˆëŠ”ë°,
        
        ![Untitled (22)](https://github.com/BJH7536/BJH7536.github.io/assets/114412598/55f19fc0-a3be-4317-a2f6-cf4249c8ecad)
        
        `==` ì—°ì‚°ìê°€ ì˜¤ë²„ë¡œë”©ë˜ì–´ìˆë‹¤. ê·¸ë¦¬ê³  ì´ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ `CompareBaseObjects`ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ë™ì‘í•¨ì„ ì•Œ ìˆ˜ ìˆëŠ”ë°
        
        í•´ë‹¹ í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜ë˜ì–´ìˆë‹¤.
        
        ```csharp
        private static bool CompareBaseObjects(Object lhs, Object rhs)
        {
            bool flag = (object)lhs == null;
            bool flag2 = (object)rhs == null;
            if (flag2 && flag)
            {
                return true;
            }
        
            if (flag2)
            {
                return !IsNativeObjectAlive(lhs);
            }
        
            if (flag)
            {
                return !IsNativeObjectAlive(rhs);
            }
        
            return lhs.m_InstanceID == rhs.m_InstanceID;
        }
        ```
        
        ë¹„êµí•˜ëŠ” ë‘ ê°ì²´ê°€ ëª¨ë‘ nullì´ë¼ë©´ true, í•œìª½ë§Œ nullì¸ ê²½ìš°ì—ëŠ” ë°˜ëŒ€ìª½ ê°ì²´ê°€ ì—¬ì „íˆ ì‚´ì•„ìˆëŠ”ì§€ (ë©”ëª¨ë¦¬ì— ì¡´ì¬í•˜ëŠ” ì§€)ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ `IsNativeObjectAlive` í•¨ìˆ˜ë¥¼ í™œìš©í•œë‹¤. 
        
        ```csharp
        private static bool IsNativeObjectAlive(Object o)
        {
            if (o.GetCachedPtr() != IntPtr.Zero)
            {
                return true;
            }
        
            if (o is MonoBehaviour || o is ScriptableObject)
            {
                return false;
            }
        
            return DoesObjectWithInstanceIDExist(o.GetInstanceID());
        }
        ```
        
        `IsNativeObjectAlive` í•¨ìˆ˜ì˜ ì •ì˜ëŠ” ìœ„ì™€ ê°™ë‹¤.
        
        `Object o`ì— ëŒ€í•´ ê°ì²´ì˜ ë„¤ì´í‹°ë¸Œ í¬ì¸í„°ë¥¼ í†µí•´ ê°ì²´ê°€ ì‚´ì•„ìˆëŠ”ì§€ë¥¼ íŒë³„í•˜ê³ , `MonoBehaviour` í˜¹ì€ `ScriptableObject` ì˜ ì¸ìŠ¤í„´ìŠ¤ì¸ì§€ í™•ì¸í•œë‹¤.
        
        ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ `DoesObjectWithInstanceIDExist` í•¨ìˆ˜ë¥¼ í™œìš©í•´ ê°ì²´ì˜ ì¸ìŠ¤í„´ìŠ¤ IDê°€ ë„¤ì´í‹°ë¸Œ ì¸¡ì—ì„œë„ ì—¬ì „íˆ ìœ íš¨í•œì§€ í™•ì¸í•œë‹¤.
        
        `GameObject`ì˜ ë ˆí¼ëŸ°ìŠ¤ë¥¼ nullê³¼ `==` ì—°ì‚°ìë¡œ ë¹„êµí•˜ë©´ ìœ„ì™€ ê°™ì€ ê³¼ì •ì„ ìˆ˜í–‰í•˜ì—¬, ì´ë¯¸ íŒŒê´´ëœ `GameObject` ë ˆí¼ëŸ°ìŠ¤ê°€ nullì´ ì•„ë‹ˆë¼ëŠ” ê²ƒì„ í™•ì¸í•˜ê²Œ ëœë‹¤. 
        
        ì´ë ‡ê²Œ `GameObject`ëŠ” íŒŒê´´ëœ í›„ì—ë„ nullì´ ì•„ë‹Œ, íŠ¹ë³„í•œ í˜•íƒœì˜ 'íŒŒê´´ëœ ìƒíƒœ'ë¥¼ ê°€ì§€ê²Œ ëœë‹¤.
        
        ì´ëŸ¬í•œ íŠ¹ì§•ì€ Unityì˜ ë©”ëª¨ë¦¬ ê´€ë¦¬ ë°©ì‹ì—ì„œ ë¹„ë¡¯ëœ ê²ƒìœ¼ë¡œ, `Destroy` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ `GameObject`ë¥¼ íŒŒê´´í•˜ëŠ” ê²½ìš°ì—ë„ ì´ë¥¼ ì°¸ì¡°í•˜ê³  ìˆëŠ” ë ˆí¼ëŸ°ìŠ¤ëŠ” ì—¬ì „íˆ 'íŒŒê´´ëœ ìƒíƒœ'ì˜ `GameObject`ë¥¼ ê°€ë¦¬í‚¤ê²Œ ëœë‹¤.
        
        ê·¸ë¦¬ê³  ì¶”ê°€ë¡œ, ì´ë ‡ê²Œ â€˜íŒŒê´´ëœ ìƒíƒœâ€™ì˜ `GameObject`ëŠ” ê·¸ `GameObject`ì— ë¶™ì–´ìˆë˜ Componentë„ ì°¸ì¡°í•  ìˆ˜ ì—†ë‹¤. ì´ ê²½ìš°ì—ë„ `MissingReferenceException` ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤. 
        
        > ë”°ë¼ì„œ `GameObject`ê°€ íŒŒê´´ëœ í›„ì—ëŠ” í•´ë‹¹ `GameObject`ë¥¼ ì°¸ì¡°í•˜ê³  ìˆëŠ” ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì ì ˆíˆ ì²˜ë¦¬í•´ì•¼ í•œë‹¤.
        > 
        
        ìœ„ ì •ë³´ë“¤ì€ ë‹¤ìŒì˜ ë§¤ë‰´ì–¼ì—ì„œë„ ì€ìœ ì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ìˆë‹¤.
        
        [Unity - Scripting API: Object.Destroy](https://docs.unity3d.com/ScriptReference/Object.Destroy.html)
        
        [Object-operator == - Unity ìŠ¤í¬ë¦½íŒ… API](https://docs.unity3d.com/kr/530/ScriptReference/Object-operator_eq.html)
        
        ì´ë ‡ê²Œ, ë‚´ë¶€ì ìœ¼ë¡œ ë³µì¡í•œ êµ¬í˜„ì„ í†µí•´ì„œ ê²°êµ­ ìš°ë¦¬ì—ê²Œ ê°„í¸í•œ ê²Œì„ ê°œë°œì´ ê°€ëŠ¥í•˜ë„ë¡ í•´ì£¼ëŠ” ìœ ë‹ˆí‹°ì—ê²Œ ì˜¤ëŠ˜ë„ ê°ì‚¬í•¨ì„ ëŠë‚€ë‹¤.
        
- ê·¸ëŸ¬ë©´ ì´ì œ ì´ ì»¨í…ì¸ ì—ì„œ ëª¬ìŠ¤í„°ì™€ í”Œë ˆì´ì–´ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ë§¤ë‹ˆì €ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì£¼ì. `GameManagerEx.cs`
    
    ```csharp
    using System.Collections.Generic;
    using UnityEngine;
    
    /// <summary>
    /// ì»¨í…ì¸ ì—ì„œ ëª¬ìŠ¤í„°ì™€ í”Œë ˆì´ì–´ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ë§¤ë‹ˆì €
    /// </summary>
    public class GameManagerEx
    {
        // í”Œë ˆì´ì–´ëŠ” í•˜ë‚˜ë¿ì´ë‹ˆê¹Œ
        private GameObject _player;
        
        // ì¤‘ë³µì„ ë°©ì§€í•˜ë©´ì„œ ëª¬ìŠ¤í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ HashSet
        private HashSet<GameObject> _monsters = new HashSet<GameObject>();
    
        /// <summary>
        /// GameObject ìƒì„±ì„ ë‹´ë‹¹í•˜ëŠ” í•¨ìˆ˜.
        /// </summary>
        /// <returns></returns>
        public GameObject Spawn(Define.WorldObject type, string path, Transform parent = null)
        {
            GameObject go = Managers.Resource.Instantiate(path, parent);
    
            switch (type)
            {
                case Define.WorldObject.Monster:
                    _monsters.Add(go);
                    break;
                case Define.WorldObject.Player:
                    _player = go;
                    break;
            }
            return go;
        }
    
        /// <summary>
        /// ì¸ìë¡œ ë°›ì€ GameObjectì˜ íƒ€ì…ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜.
        /// </summary>
        /// <param name="go"></param>
        /// <returns></returns>
        public Define.WorldObject GetWorldObjectType(GameObject go)
        {
            BaseController bc = go.GetComponent<BaseController>();
    
            if (bc == null)
                return Define.WorldObject.Unknown;
            
            return bc.WorldObjectType;
        }
        
        /// <summary>
        /// GameObjectë¥¼ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜.
        /// ì‚­ì œí•˜ê³ ì í•˜ëŠ” GameObjectë¥¼ ê´€ë¦¬ëª©ë¡ì—ì„œë„ ì§€ìš°ê³ , Destroyí•œë‹¤.
        /// </summary>
        /// <param name="go">ì‚­ì œí•˜ê³ ì í•˜ëŠ” GameObject</param>
        public void Despawn(GameObject go)
        {
            Define.WorldObject type = GetWorldObjectType(go);
    
            switch (type)
            {
                case Define.WorldObject.Monster:
                    if (_monsters.Contains(go))
                        _monsters.Remove(go);
                    break;
                case Define.WorldObject.Player:
                    if (_player == go)
                        _player = null;
                    break;
            }
            
            Managers.Resource.Destroy(go);
        }
    }
    ```
    
    ê·¸ë¦¬ê³  ì—¬ê¸°ì„œ ì‚¬ìš©í•˜ëŠ” ì—´ê±°í˜•ë„ `Define`ì— ì¶”ê°€í•´ì£¼ì.
    
    ```csharp
    public class Define
    {
        ...
    
        public enum WorldObject
        {
            Unknown,
            Player,
            Monster,
        }
    
        ...
    }	
    ```
    
ê·¸ë¦¬ê³  `BaseController.cs` ì—ëŠ” ë‹¤ìŒì˜ í”„ë¡œí¼í‹°ë¥¼ ì¶”ê°€í•˜ê³ 

```csharp
// ì´ GameObjectì˜ WorldObject íƒ€ì…ì„ ì €ì¥í•˜ëŠ” í”„ë¡œí¼í‹°
public Define.WorldObject WorldObjectType { get; protected set; } = Define.WorldObject.Unknown;
```

`PlayerController.cs` ì™€ `MonsterController.cs`ì˜ `Init`í•¨ìˆ˜ ë‚´ì—ëŠ” ê°ê° ìì‹ ì—ê²Œ ë§ëŠ” ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•´ì£¼ëŠ” ì½”ë“œë¥¼ í•œ ì¤„ ì‘ì„±í•´ì£¼ì.

ê·¸ë¦¬ê³  ì´ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ `GameScene.cs`ì˜ `Init`ì— `Managers.Game.Spawn()` í•¨ìˆ˜ë¥¼ ì´ìš©í•´ í”Œë ˆì´ì–´ì™€ ëª¬ìŠ¤í„°ë¥¼ í•˜ë‚˜ì”© ìŠ¤í°ì‹œí‚¤ë©´â€¦ (Sceneì˜ í”Œë ˆì´ì–´ì™€ ëª¬ìŠ¤í„°ëŠ” ì§€ìš´ë‹¤)

ì˜¤ë¥˜ê°€ ë‚œë‹¤. ì™œ?

`CameraController.cs`ì˜ `_player`ê°€ nullì´ ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤. ì´ëŠ” ì´ì „ì— ë§Œë“¤ ë•Œ íˆ´ì—ì„œ ë“œë˜ê·¸ì•¤ë“œë¡­ìœ¼ë¡œ í• ë‹¹í•´ì£¼ì–´ ì¼ì–´ë‚œ ì˜¤ë¥˜.

`CameraController.cs`ì—ëŠ” ë‹¤ìŒì˜ í•¨ìˆ˜ë¥¼ ì¶”ê°€í•´ì£¼ê³ 


```csharp
public void SetPlayer(GameObject player)
{
    _player = player;
}
```
    
í”Œë ˆì´ì–´ê°€ ì£½ì–´ì„œ ì‚¬ë¼ì¡Œì„ ë•Œ ì˜¤ë¥˜ë¥¼ ë§‰ê¸°ìœ„í•´ ì¼ë‹¨ `MonsterController.cs`ë‚´ë¶€ì˜ í”Œë ˆì´ì–´ ì‚­ì œì½”ë“œë¥¼ `Destroy`ì—ì„œ `Managers.Game.Despawn`ìœ¼ë¡œ ìˆ˜ì •.

ê·¸ë¦¬ê³  `Extension.cs`ì—ì„œ ë‹¤ìŒì˜ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

```csharp
/// <summary>
/// <see cref="Poolable"/>í•œ GameObjectê°€ ìœ íš¨í•œì§€ ê²€ì‚¬í•˜ëŠ” í•¨ìˆ˜.
/// </summary>
/// <param name="go"></param>
/// <returns></returns>
public static bool IsValid(this GameObject go)
{
    return go != null && go.activeSelf == true;
}
```
    
ìœ„ XML ë¬¸ì„œì—ì„œ ì•Œ ìˆ˜ ìˆë“¯, `Poolable`í•œ `GameObject`ëŠ” `Managers.Resource.Destroy` í•¨ìˆ˜ê°€ `Pool`ë¡œ ë˜ëŒë ¤ë²„ë¦¬ê¸° ë•Œë¬¸ì—, ìœ„ í•¨ìˆ˜ë¥¼ ì¶”ê°€í–ˆë‹¤.

ê·¸ë¦¬ê³  `CameraController.cs`ì˜ ì›ë˜ `_player`ë¡œ ì¸í•´ ì˜¤ë¥˜ë‚˜ëŠ” ê³³ì—ì„œëŠ” `IsValid`ë¥¼ í™œìš©í•´ ì¡°ê±´ë¬¸ìœ¼ë¡œ ì´ë¥¼ í•´ê²°.
    
```csharp
private void LateUpdate()      
{
    if (_mode == Define.CameraMode.QuarterView)
    {
        if(_player.IsValid() == false)
        {
            return;
        }
        ...
```

## ë ˆë²¨ì—…

- `MonsterController` í´ë˜ìŠ¤ì— ì•½ê°„ì˜ ìˆ˜ì •ì„ ë¨¼ì € ê°€í•´ì•¼ê² ë‹¤.
- ë¨¼ì € `UpdateIdle` í•¨ìˆ˜
    
    ì´ì „ì— ë§Œë“¤ì—ˆë˜ `UpdateIdle` í•¨ìˆ˜ì—ì„œëŠ” `GameObject.FindGameObjectWithTag` í•¨ìˆ˜ë¥¼ í™œìš©í•´ í”Œë ˆì´ì–´ë¥¼ ì°¾ì•˜ëŠ”ë°, ì´ë ‡ê²Œ í•˜ê¸°ë³´ë‹¤ `GameManagerEx` í´ë˜ìŠ¤ê°€ ìƒê²¼ìœ¼ë‹ˆ ì´ë¥¼ í™œìš©í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ìˆ˜ì •í•˜ì.
    
    ë¨¼ì € `GameManagerEx`í´ë˜ìŠ¤ì—ì„  `_player` ë³€ìˆ˜ë¡œ í”Œë ˆì´ì–´ `GameObject`ë¥¼ ìºì‹±í•´ì„œ ê°€ì§€ê³ ìˆìœ¼ë‹ˆ, ë‹¨ìˆœíˆ ì´ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜(`GetPlayer`)ë¥¼ ì¶”ê°€í•´ì£¼ê³ .
    
    ì´ í•¨ìˆ˜ë¡œ ê¸°ì¡´ì˜ `GameObject.FindGameObjectWithTag` í•¨ìˆ˜ë¥¼ ëŒ€ì²´.
    
- ê·¸ë¦¬ê³  `OnHitEvent` í•¨ìˆ˜
    
    ì—¬ê¸°ëŠ” ê³µê²©ì— ëŒ€í•´ì„œ ì¢€ ë” ê³¨ë˜˜íˆ ê³ ë¯¼í•´ë´ì•¼ í•˜ëŠ” ë¶€ë¶„ì´ë¼ê³  ìƒê°í•˜ëŠ”ë°, ë‹¨ìˆœí•œ ë¯¸ë‹ˆ ê²Œì„ì„ ë§Œë“¤ë•ŒëŠ” í•´ë‹¹ì‚¬í•­ì´ ì—†ì„ ìˆ˜ë„ ìˆê² ì§€ë§Œ, ê°•ì˜ ì˜ìƒì—ì„œ ë§í•˜ëŠ” ë¶€ë¶„ì— ëŒ€í•´ ë°±ë²ˆ ê³µê°í•œë‹¤.
    
    > ê³µê²©ì´ë¼ëŠ” í–‰ìœ„ì— ëŒ€í•´ì„œ ê³µê²©ìê°€ í”¼ê²©ìì˜ ì²´ë ¥ì— ì§ì ‘ ì ‘ê·¼í•´ ì¡°ì‘í•˜ê¸°ë³´ë‹¤, í”¼ê²©ìê°€ ìì‹ ì˜ ì²´ë ¥ì„ ì¡°ì‘í•˜ë„ë¡ í•˜ëŠ”í¸ì´ ë” ë‚«ë‹¤.
    > ë°©ì–´ë ¥, ë³´í˜¸ë§‰ ë“±ë“± í”¼í•´ë¥¼ ê²½ê°í•˜ëŠ” ê°œë…ì´ ìƒê¸°ë©´ ê·¸ê²ƒì„ ëª¨ë‘ ê³µê²©ìê°€ ì²˜ë¦¬í•˜ê²Œ í•˜ê¸°ë³´ë‹¤, í”¼ê²©ìê°€ ì²˜ë¦¬í•˜ê²Œë” í•˜ëŠ” í¸ì´ ë” ë‚«ê¸° ë•Œë¬¸.
     
    ìœ„ì™€ ê°™ì´ ì„¤ëª…í•œë‹¤. ë‹¨ìˆœíˆ ì½”ë“œë¥¼ ì–´ë–»ê²Œ ì§œì•¼í• ê¹Œ í•˜ê³  ì ì‹œë§Œ ê³ ë¯¼ì„ í•´ë´ë„, ì „ìë¥¼ êµ¬í˜„í•˜ë ¤ë©´ ê³µê²©ìê°€ ê³µê²©í•˜ëŠ” í•¨ìˆ˜ ì•ˆì—ì„œ ì •ë§ ë§ì€ ë¶€ë¶„ì„ ê²€ì‚¬í•´ì•¼í•œë‹¤.
    
    ìƒëŒ€ê°€ ë°©ì–´ë ¥ì´ ëª‡ì¸ì§€, ë³´í˜¸ë§‰ì˜ ìœ ë¬´ ë“±ë“± ë‹¤ì–‘í•œ ì¡°ê±´ë¬¸ì´ ê·¸ ì•ˆì— ë•ì§€ë•ì§€ ë¶™ì„ ê²ƒì´ê³ , ê²Œì„ì´ ì—…ë°ì´íŠ¸ë˜ë©´ì„œ í”¼í•´ë¥¼ ê²½ê°í•˜ëŠ” ê°œë…ì´ ìƒê²¨ë‚  ë•Œ ë§ˆë‹¤ ì´ í•¨ìˆ˜ë¥¼ ìê¾¸ìê¾¸ ìˆ˜ì •í•´ì¤˜ì•¼í•œë‹¤.
    
    ê·¸ë ‡ê²Œí•˜ê¸°ë³´ë‹¤, ì²´ë ¥ì„ ê°€ì§„ ëª¨ë“  ê°ì²´ì—ê²Œ `ìŠ¤ìŠ¤ë¡œ í”¼í•´ë¥¼ ë°›ëŠ” í•¨ìˆ˜`ë¥¼ ë§Œë“¤ì–´ë†“ê³ , ì´ë¥¼ ê³µê²©ìê°€ í˜¸ì¶œí•˜ëŠ”ê²ƒì´ ì½”ë“œê°€ ê¹”ë”í•´ì§€ì§€ ì•Šì„ê¹Œ? 
    
    - ê·¸ë ‡ê¸° ë•Œë¬¸ì—, ëª¨ë“  í”Œë ˆì´ì–´ì™€ ëª¬ìŠ¤í„°ê°€ ëª¨ë‘ í™œìš©í•˜ëŠ” `Stat`í´ë˜ìŠ¤ ë‚´ì— `ìŠ¤ìŠ¤ë¡œ í”¼í•´ë¥¼ ë°›ëŠ” í•¨ìˆ˜`ë¥¼ ë§Œë“¤ì–´ ë†“ì.
        
        ```csharp
        /// <summary>
        /// í”¼í•´ë¥¼ ë°›ì„ ë•Œ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜
        /// </summary>
        public virtual void OnAttacked(Stat attacker)
        {
            int damage = attacker.Attack - Defense;
            Hp -= (damage) <= 0 ? 1 : damage;    // ë°ë¯¸ì§€ê°€ ìµœì†Œ 1ì€ ë“¤ì–´ê°€ê²Œë”
        
            if (Hp <= 0)
            {
                Hp = 0;
                OnDead();
            }
        }
        
        /// <summary>
        /// í”¼í•´ë¥¼ ë°›ì•„ ì²´ë ¥ì´ 0ì´í•˜ê°€ ë˜ì—ˆì„ ë•Œ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜
        /// GameObject ìŠ¤ìŠ¤ë¡œë¥¼ íŒŒê´´ì‹œí‚¨ë‹¤.
        /// </summary>
        protected virtual void OnDead()
        {
            Managers.Game.Despawn(gameObject);
        }
        ```
        
        ê·¸ë¦¬ê³  ì´ë¥¼ ë§Œë“¤ì—ˆìœ¼ë©´, ì´ë¥¼ `PlayerController`í´ë˜ìŠ¤ì™€ `MonsterController`í´ë˜ìŠ¤ì—ì„œ í™œìš©í•˜ë„ë¡ ìˆ˜ì •í•˜ì.
        
        `OnDead` í•¨ìˆ˜ëŠ” PlayerStat í´ë˜ìŠ¤ì—ì„œ `override`í•˜ëŠ”ë°, ì¼ë‹¨ì€ ì•„ë¬´í–‰ë™ë„ í•˜ì§€ ì•Šë„ë¡ í•˜ì.
        
    
    í…ŒìŠ¤íŠ¸ ê²°ê³¼, ì •ìƒì ìœ¼ë¡œ ë™ì‘í•œë‹¤.
    
- ê·¸ëŸ¬ë©´ ì´ì œ ëª¬ìŠ¤í„°ë¥¼ ì¡ìœ¼ë©´, í”Œë ˆì´ì–´ì˜ ê²½í—˜ì¹˜ê°€ ì˜¤ë¥´ë„ë¡ ê²½í—˜ì¹˜ë¥¼ êµ¬í˜„í•´ë³´ì.
    - ê²½í—˜ì¹˜ë¥¼ ì£¼ëŠ”ê±´, ê²°êµ­ í”Œë ˆì´ì–´ì—ê²Œ ì£½ì€ ëª¬ìŠ¤í„°ê°€ ì£¼ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì—, `Stat` í´ë˜ìŠ¤ì—ì„œ ì´ë¥¼ êµ¬í˜„í•˜ì.
        
        ```csharp
        /// <summary>
        /// í”¼í•´ë¥¼ ë°›ì•„ ì²´ë ¥ì´ 0ì´í•˜ê°€ ë˜ì—ˆì„ ë•Œ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜.
        /// GameObject ìŠ¤ìŠ¤ë¡œë¥¼ íŒŒê´´ì‹œí‚¨ë‹¤.
        /// </summary>
        protected virtual void OnDead(Stat attacker)
        {
            // ê³µê²©ìì˜ íƒ€ì…ì´ Playerì¼ ë•Œë§Œ ê²½í—˜ì¹˜ë¥¼ ì£¼ë„ë¡.
            PlayerStat playerStat = attacker as PlayerStat;
            if (playerStat != null)
            {
                playerStat.Exp += 5;
            }
            
            Managers.Game.Despawn(gameObject);
        }
        ```
        
        ì¼ë‹¨ì€ ê³ ì •ëœ ìˆ˜ì¹˜ë§Œí¼ ê²½í—˜ì¹˜ 5ë¥¼ ì£¼ë„ë¡ ë§Œë“¤ì—ˆë‹¤.
        
        ê·¸ë¦¬ê³  ë ˆë²¨ì—…ì´ ë˜ë ¤ë©´ ë¨¼ì € ë ˆë²¨ì—…ì˜ ê¸°ì¤€ì´ ë˜ëŠ” ìˆ˜ì¹˜ê°€ í•„ìš”í•  ê²ƒì´ê³ , ì´ë¥¼ ê° ë ˆë²¨ë§ˆë‹¤ ë°ì´í„°ë¡œ ì €ì¥í•´ì•¼ í•  ê²ƒì´ë‹¤.
        
        - ê·¸ë˜ì„œ í”„ë¡œì íŠ¸ì— ì €ì¥í•œ ë°ì´í„°íŒŒì¼ì„ ìˆ˜ì •í•˜ê³  (`totalExp` ì¶”ê°€)
            
            ```json
            {
              "stats" : [
                {
                  "level" : "1",
                  "maxHp" : "200",
                  "attack" : "20",
                  "totalExp" : "0"
                },
                {
                  "level" : "2",
                  "maxHp" : "250",
                  "attack" : "25",
                  "totalExp" : "10"
                },
                {
                  "level" : "3",
                  "maxHp" : "300",
                  "attack" : "30",
                  "totalExp" : "20"
                }
              ]
            }
            ```
            
        - ì´ë¥¼ ì½ì„ ë•Œ ë°ì´í„° í¬ë§·ì´ ë˜ëŠ” í´ë˜ìŠ¤ë„ ìˆ˜ì •í•´ì£¼ì
            
            ```csharp
            namespace Data
            {
                /// <summary>
                /// ìºë¦­í„°ì˜ ëŠ¥ë ¥ì¹˜ë¥¼ ì •ì˜í•˜ëŠ” í´ë˜ìŠ¤.
                /// JsoníŒŒì¼ì„ ì½ê³  ì“°ëŠ” í¬ë§·ì´ ë˜ì–´ì¤€ë‹¤.
                /// </summary>
                [Serializable]
                public class Stat
                {
                    public int level;       // ìºë¦­í„°ì˜ ë ˆë²¨
                    public int maxHp;       // ìºë¦­í„°ì˜ ì²´ë ¥
                    public int attack;      // ìºë¦­í„°ì˜ ê³µê²©ë ¥
                    public int totalExp;    // ìºë¦­í„°ì˜ ë ˆë²¨ì—… ê²½í—˜ì¹˜
                }
                ...
            ```
            
        - ê·¸ë¦¬ê³  ì´ë¥¼ í™œìš©í•´ ë ˆë²¨ì—… ë¡œì§ì„ ë§Œë“¤ì–´ì¤˜ì•¼ í•œë‹¤. ë°ì´í„°ì— ë§ì¶°ì„œ ìŠ¤í…Ÿë“¤ì„ ì´ˆê¸°í™”í•˜ëŠ” ë¡œì§ë„ í•¨ê»˜ êµ¬í˜„í•´ë³´ì
            
            ```csharp
            public class PlayerStat : Stat
            {
                [SerializeField] 
                protected int _exp;
                [SerializeField] 
                protected int _gold;
            
                public int Exp
                {
                    get => _exp;
                    set
                    {
                        _exp = value;
                        
                        // ë ˆë²¨ì—… ì²´í¬
                        // ê²½í—˜ì¹˜ë¥¼ ë°›ì•˜ì„ ë•Œ ë ˆë²¨ì—…ì´ ê°€ëŠ¥í•˜ë„ë¡
                        int level = Level;
                        while (true)
                        {
                            if (Managers.Data.StatDict.TryGetValue(level + 1, out var stat) == false)
                                break;
                            if (_exp < stat.totalExp)
                                break;
                            level++;
                        }
            
                        // ë ˆë²¨ì—…ì´ ì¼ì–´ë‚¬ë‹¤ë©´,
                        // ê·¸ ë ˆë²¨ì— ë§ì¶°ì„œ ìŠ¤í…Ÿë“¤ì„ ìˆ˜ì •
                        if (level != Level)
                        {
                            Level = level;
                            SetStat(Level);
                            Debug.Log(Level);
                        }
                    }
                }
            
                public int Gold
                {
                    get => _gold;
                    set => _gold = value;
                }
                
                private void Start()
                {
                    // ì´ˆê¸°í™”
                    _level = 1;
            
                    SetStat(1);
                    _defense = 5;
                    _moveSpeed = 5.0f;
                    _gold = 0;
                }
            
                public void SetStat(int level)
                {
                    // ResourceManagerë¥¼ í†µí•´ Statë°ì´í„°ë¥¼ ì½ì–´ì™€ì„œ ì´ˆê¸°í™”
                    Dictionary<int, Data.Stat> statDict = Managers.Data.StatDict;
            
                    _hp = statDict[level].maxHp;
                    _maxHp = statDict[level].maxHp;
                    _attack = statDict[level].attack;
                }
            
                protected override void OnDead(Stat attacker)
                {
                    Debug.Log("PlayerDead");
                }
            }
            
            ```
            
            - `_defense`, `_moveSpeed`, `_gold` ëŠ” ì €ì¥ëœ ë°ì´í„°ë¥¼ ì°¸ê³ í•˜ì§€ ì•ŠëŠ”ë°, ì°¸ê³ í•˜ë„ë¡ ìˆ˜ì •í•  ìˆ˜ë„ ìˆê² ë‹¤.

## ëª¬ìŠ¤í„° ìë™ ìƒì„±

- ëª¬ìŠ¤í„°ê°€ ìë™ìœ¼ë¡œ ë¦¬ìŠ¤í°ë˜ëŠ” ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ë³´ì
- íŠ¹ì •í•œ ì˜ì—­ë‚´ì˜ ëª¬ìŠ¤í„°ì˜ ê°¯ìˆ˜ë¥¼ ì •í•´ì§„ ê°¯ìˆ˜ë§Œí¼ ìœ ì§€ì‹œí‚¤ë„ë¡ í•˜ì—¬, í”Œë ˆì´ì–´ê°€ í•˜ë‚˜ë¥¼ ì£½ì´ë©´ ì ê¹ì˜ ëŒ€ê¸° ì‹œê°„ í›„ì— ëª¬ìŠ¤í„°ê°€ ë¦¬ìŠ¤í°ë˜ê²Œí•˜ëŠ” ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ë³´ì.
- í•´ë‹¹ ì‹œìŠ¤í…œì„ ê´€ë¦¬í•  `SpawningPool` í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì
    - ê¸°ì¡´ì— ëª¬ìŠ¤í„°ë¥¼ Spawnì‹œí‚¤ê³  ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ëŠ” `GameManager` ì´ë‹ˆê¹Œ, ì—¬ê¸°ì— `Action<T>`ì„ ë§Œë“¤ì–´ ì´ë¥¼ í™œìš©í•˜ì—¬ ë§Œë“¤ì
    
    ```csharp   
    /// <summary>
    /// ëª¬ìŠ¤í„°ì˜ ë¦¬ìŠ¤í°ì„ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤
    /// </summary>
    public class SpawningPool : MonoBehaviour
    {
        // í˜„ì¬ ì¡´ì¬í•˜ëŠ” ëª¬ìŠ¤í„°ì˜ ìˆ˜
        // GameManagerì˜ OnSpawnEventë¥¼ í˜¸ì¶œí•˜ì—¬ ì´ ìˆ«ìë¥¼ ê´€ë¦¬í•œë‹¤.
        [SerializeField] 
        private int _monsterCount = 0;
        private int reserveCount = 0;
        
        // ìœ ì§€ì‹œì¼œì•¼ í•˜ëŠ” ëª¬ìŠ¤í„°ì˜ ìˆ˜
        [SerializeField] 
        private int _keepMonsterCount = 0;
    
        // ìŠ¤í° ê¸°ì¤€ì ê³¼ ë°˜ê²½
        [SerializeField] 
        private Vector3 spawnPos;
        [SerializeField] 
        private float _spawnRadius = 15;
    
        // ìŠ¤í° ë”œë ˆì´
        [SerializeField] 
        private float spawnDelay = 5.0f;
        
        public void AddMonsterCount(int value) { _monsterCount += value; }
        public void SetKeepMonsterCount(int count) { _keepMonsterCount = count; }
        
        void Start()
        {
            Managers.Game.OnSpawnEvent -= AddMonsterCount;
            Managers.Game.OnSpawnEvent += AddMonsterCount;
        }
    
        void Update()
        {
            while (reserveCount + _monsterCount < _keepMonsterCount)
            {
                StartCoroutine(nameof(ReserveSpawn));
            }
        }
    
        IEnumerator ReserveSpawn()
        {
            reserveCount++;
            
            // ë”œë ˆì´ ì ìš©
            yield return new WaitForSeconds(Random.Range(0, spawnDelay));
            
            GameObject monster = Managers.Game.Spawn(Define.WorldObject.Monster,"DarkKnight");
            var nma = monster.GetOrAddComponent<NavMeshAgent>();
    
            Vector3 randPos;
            while (true)
            {
                // ì •í•´ì§„ ì§€ì ìœ¼ë¡œë¶€í„° ì¼ì • ë°˜ê²½ ë‚´ì˜ ë¬´ì‘ìœ„ ì¥ì†Œì— Spawn.
                Vector3 randDir = Random.insideUnitSphere * Random.Range(0, _spawnRadius);
                randDir.y = 0;
                randPos = spawnPos + randDir;
    
                // ì •í•´ì§„ ì¥ì†Œê°€ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” ê³³ì¸ì§€ ê²€ì‚¬
                NavMeshPath path = new NavMeshPath();
                if (nma.CalculatePath(randPos, path))
                    break;
            }
    
            monster.transform.position = randPos;
            reserveCount--;
        }
    }
    
    ```
    
- ì´ì— ë§ì¶° `GameManagerEx` í´ë˜ìŠ¤ë„ ìˆ˜ì •í•˜ì.
    
    ```csharp
    /// <summary>
    /// ì»¨í…ì¸ ì—ì„œ ëª¬ìŠ¤í„°ì™€ í”Œë ˆì´ì–´ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ë§¤ë‹ˆì €
    /// </summary>
    public class GameManagerEx
    {
        // í”Œë ˆì´ì–´ëŠ” í•˜ë‚˜ë¿ì´ë‹ˆê¹Œ
        private GameObject _player;
        
        // ì¤‘ë³µì„ ë°©ì§€í•˜ë©´ì„œ ëª¬ìŠ¤í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ HashSet
        private HashSet<GameObject> _monsters = new HashSet<GameObject>();
    
        // ëª¬ìŠ¤í„°ê°€ ì¶”ê°€ë˜ê±°ë‚˜ ì‚­ì œë  ë•Œ SpawningPoolì—ê²Œë„ ì „ë‹¬í•˜ê¸° ìœ„í•œ Action
        // ë§¤ê°œë³€ìˆ˜ëŠ” ëŠ˜ê±°ë‚˜, ì¤„ì–´ë“¤ì€ ìˆ«ì
        public Action<int> OnSpawnEvent;
    
        /// <summary>
        /// í”Œë ˆì´ì–´ë¥¼ ì°¾ê¸° ìœ„í•œ í•¨ìˆ˜
        /// </summary>
        /// <returns></returns>
        public GameObject GetPlayer()
        {
            return _player;
        }
        
        /// <summary>
        /// GameObject ìƒì„±ì„ ë‹´ë‹¹í•˜ëŠ” í•¨ìˆ˜.
        /// </summary>
        /// <returns></returns>
        public GameObject Spawn(Define.WorldObject type, string path, Transform parent = null)
        {
            GameObject go = Managers.Resource.Instantiate(path, parent);
    
            switch (type)
            {
                case Define.WorldObject.Monster:
                    _monsters.Add(go);
                    OnSpawnEvent?.Invoke(1);
                    break;
                case Define.WorldObject.Player:
                    _player = go;
                    break;
            }
            return go;
        }
    
        /// <summary>
        /// ì¸ìë¡œ ë°›ì€ GameObjectì˜ íƒ€ì…ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜.
        /// </summary>
        /// <param name="go"></param>
        /// <returns></returns>
        public Define.WorldObject GetWorldObjectType(GameObject go)
        {
            BaseController bc = go.GetComponent<BaseController>();
    
            if (bc == null)
                return Define.WorldObject.Unknown;
            
            return bc.WorldObjectType;
        }
        
        /// <summary>
        /// GameObjectë¥¼ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜.
        /// ì‚­ì œí•˜ê³ ì í•˜ëŠ” GameObjectë¥¼ ê´€ë¦¬ëª©ë¡ì—ì„œë„ ì§€ìš°ê³ , Destroyí•œë‹¤.
        /// </summary>
        /// <param name="go">ì‚­ì œí•˜ê³ ì í•˜ëŠ” GameObject</param>
        public void Despawn(GameObject go)
        {
            Define.WorldObject type = GetWorldObjectType(go);
    
            switch (type)
            {
                case Define.WorldObject.Monster:
                    if (_monsters.Contains(go))
                    {
                        _monsters.Remove(go);
                        OnSpawnEvent?.Invoke(-1);
                    }
                    break;
                case Define.WorldObject.Player:
                    if (_player == go)
                        _player = null;
                    break;
            }
            
            Managers.Resource.Destroy(go);
        }
    }
    ```